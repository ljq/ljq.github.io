<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta><title>PostgreSQL深度实践：从Debian 12入门到集群部署及多语言应用 - Jaco Liu Personal Site (ljq@GitHub).安全贯穿于软件开发各个环节.</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Jaco Liu Personal Site (ljq@GitHub).安全贯穿于软件开发各个环节."><meta name="msapplication-TileImage" content="/img/favicon.ico"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Jaco Liu Personal Site (ljq@GitHub).安全贯穿于软件开发各个环节."><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="PG简述PostgreSQL作为世界上最先进的开源关系型数据库系统，凭借其强大的功能、卓越的性能和严格的ACID特性，已经成为企业级应用的首选数据库之一。本文将带领读者从零开始，在Debian 12环境下深入掌握PostgreSQL，涵盖版本演进、核心原理、实战配置、集群部署以及多语言应用开发，为数据库工程师和开发者提供一套完整的实践指南，包含常用的一些语法操作和最佳实践等等。"><meta property="og:type" content="blog"><meta property="og:title" content="PostgreSQL深度实践：从Debian 12入门到集群部署及多语言应用"><meta property="og:url" content="https://www.wdft.com/2d0307b0.html"><meta property="og:site_name" content="Jaco Liu Personal Site (ljq@GitHub).安全贯穿于软件开发各个环节."><meta property="og:description" content="PG简述PostgreSQL作为世界上最先进的开源关系型数据库系统，凭借其强大的功能、卓越的性能和严格的ACID特性，已经成为企业级应用的首选数据库之一。本文将带领读者从零开始，在Debian 12环境下深入掌握PostgreSQL，涵盖版本演进、核心原理、实战配置、集群部署以及多语言应用开发，为数据库工程师和开发者提供一套完整的实践指南，包含常用的一些语法操作和最佳实践等等。"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://www.wdft.com/assets/images/db.jpg"><meta property="article:published_time" content="2025-12-17T15:37:19.000Z"><meta property="article:modified_time" content="2026-01-29T02:13:01.198Z"><meta property="article:author" content="Jaco Liu"><meta property="article:tag" content="Tutorial"><meta property="article:tag" content="RDBMS"><meta property="article:tag" content="postgresql"><meta property="article:tag" content="postgresql-syntax"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/assets/images/db.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.wdft.com/2d0307b0.html"},"headline":"PostgreSQL深度实践：从Debian 12入门到集群部署及多语言应用","image":["https://www.wdft.com/assets/images/db.jpg"],"datePublished":"2025-12-17T15:37:19.000Z","dateModified":"2026-01-29T02:13:01.198Z","author":{"@type":"Person","name":"Jaco Liu"},"publisher":{"@type":"Organization","name":"Jaco Liu Personal Site (ljq@GitHub).安全贯穿于软件开发各个环节.","logo":{"@type":"ImageObject","url":"https://www.wdft.com/img/logo.svg"}},"description":"PG简述PostgreSQL作为世界上最先进的开源关系型数据库系统，凭借其强大的功能、卓越的性能和严格的ACID特性，已经成为企业级应用的首选数据库之一。本文将带领读者从零开始，在Debian 12环境下深入掌握PostgreSQL，涵盖版本演进、核心原理、实战配置、集群部署以及多语言应用开发，为数据库工程师和开发者提供一套完整的实践指南，包含常用的一些语法操作和最佳实践等等。"}</script><link rel="canonical" href="https://www.wdft.com/2d0307b0.html"><link rel="alternate" href="/atom.xml" title="Jaco Liu Personal Site (ljq@GitHub).安全贯穿于软件开发各个环节." type="application/atom+xml"><link rel="icon" href="/img/favicon.ico"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.15.2/css/all.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><script>!function(){var e=document.createElement("script"),t=(e.src="//hm.baidu.com/hm.js?45914c5ebb523a9ed07ab35e4dc81374",document.getElementsByTagName("script")[0]);t.parentNode.insertBefore(e,t)}()</script><meta name="msvalidate.01" content="ad0df3c8d20f49daaeb5baa3c9dbfe75"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/cookieconsent/3.1.1/cookieconsent.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/lightgallery/1.10.0/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.8.1/css/justifiedGallery.min.css"><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdnjs.loli.net/ajax/libs/pace/1.2.4/pace.min.js"></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8952360410310192" crossorigin="anonymous"></script><script>!function(){function e(){if(location.hash){Array.from(document.querySelectorAll(".tab-content")).forEach(e=>{e.classList.add("is-hidden")}),Array.from(document.querySelectorAll(".tabs li")).forEach(e=>{e.classList.remove("is-active")});const e=document.querySelector(location.hash),t=(e&&e.classList.remove("is-hidden"),document.querySelector(`a[href="${location.hash}"]`));t&&t.parentElement.classList.add("is-active")}}e(),window.addEventListener("hashchange",e,!1)}()</script><meta name="generator" content="Hexo 6.1.0"></head><body class="is-2-column"><img src="/img/avatar.jpeg" width="0" height="0"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="Jaco Liu Personal Site (ljq@GitHub).安全贯穿于软件开发各个环节." height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/musics">Musics</a><a class="navbar-item" href="/videos">Videos</a><a class="navbar-item" href="/galleries">Galleries</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item dark-mode-btn" title="Light|Dark" rel="noopener" onclick="switchDarkMode()">    <i class="fas fa-lightbulb">  </i></a><a class="navbar-item" target="_blank" rel="noopener" title="Musics" href="/musics"><i class="fas fa-music"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="Videos" href="/videos"><i class="fas fa-video"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="WeChat Account (labsec)" href="/assets/images/about/ljq-qrcode.jpeg"><i class="fab fa-weixin"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="Jaco Liu GitHub" href="https://github.com/ljq"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-9-widescreen"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="/assets/images/db.jpg" alt="PostgreSQL深度实践：从Debian 12入门到集群部署及多语言应用"></span></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time datetime="2025-12-17T15:37:19.000Z" title="12/17/2025, 11:37:19 PM">2025-12-17</time></span><span class="level-item">Updated&nbsp;<time datetime="2026-01-29T02:13:01.198Z" title="1/29/2026, 10:13:01 AM">2026-01-29</time></span><span class="level-item"> Jaco Liu </span><span class="level-item"><a class="link-muted" href="/categories/rdbms/">rdbms</a><span> / </span><a class="link-muted" href="/categories/rdbms/postgres/">postgres</a></span><span class="level-item">an hour read (About 6890 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">PostgreSQL深度实践：从Debian 12入门到集群部署及多语言应用</h1><div class="content"><h2 id="PG简述"><a href="#PG简述" class="headerlink" title="PG简述"></a>PG简述</h2><p>PostgreSQL作为世界上最先进的开源关系型数据库系统，凭借其强大的功能、卓越的性能和严格的ACID特性，已经成为企业级应用的首选数据库之一。<br>本文将带领读者从零开始，在Debian 12环境下深入掌握PostgreSQL，涵盖版本演进、核心原理、实战配置、集群部署以及多语言应用开发，为数据库工程师和开发者提供一套完整的实践指南，包含常用的一些语法操作和最佳实践等等。</p><span id="more"></span><hr><h2 id="第一部分：PostgreSQL版本历史与特性演进"><a href="#第一部分：PostgreSQL版本历史与特性演进" class="headerlink" title="第一部分：PostgreSQL版本历史与特性演进"></a>第一部分：PostgreSQL版本历史与特性演进</h2><h3 id="1-1-版本发展脉络"><a href="#1-1-版本发展脉络" class="headerlink" title="1.1 版本发展脉络"></a>1.1 版本发展脉络</h3><p>PostgreSQL的发展历程见证了开源数据库技术的演进：</p><ul><li><strong>PostgreSQL 7.x (2000-2005)</strong>: 从Postgres95更名而来，引入了真正的多版本并发控制（MVCC）</li><li><strong>PostgreSQL 8.x (2005-2010)</strong>: Windows原生支持、自动清理、表空间管理</li><li><strong>PostgreSQL 9.x (2010-2016)</strong>: 流复制、JSON支持、物化视图</li><li><strong>PostgreSQL 10.x (2017)</strong>: 逻辑复制、声明式分区、并行查询增强</li><li><strong>PostgreSQL 11.x (2018)</strong>: JIT编译、存储过程、分区表性能优化</li><li><strong>PostgreSQL 12.x (2019)</strong>: 通用表表达式（CTE）性能优化、JSON路径表达式</li><li><strong>PostgreSQL 13.x (2020)</strong>: 增量排序、B-tree索引优化、逻辑复制改进</li><li><strong>PostgreSQL 14.x (2021)</strong>: 多范围类型、数据类型优化、性能监控增强</li><li><strong>PostgreSQL 15.x (2022)</strong>: MERGE命令、分布式SQL功能增强</li><li><strong>PostgreSQL 16.x (2023)</strong>: 逻辑复制性能大幅提升、查询并行化改进</li></ul><h3 id="1-2-关键特性对比"><a href="#1-2-关键特性对比" class="headerlink" title="1.2 关键特性对比"></a>1.2 关键特性对比</h3><table><thead><tr><th>特性</th><th>PostgreSQL 12</th><th>PostgreSQL 14</th><th>PostgreSQL 16</th></tr></thead><tbody><tr><td>逻辑复制</td><td>基础支持</td><td>大幅改进</td><td>性能提升300%</td></tr><tr><td>并行查询</td><td>有限支持</td><td>增强支持</td><td>完全优化</td></tr><tr><td>JSON支持</td><td>JSONB类型</td><td>JSON路径表达式</td><td>完整SQL&#x2F;JSON标准</td></tr><tr><td>分区表</td><td>声明式分区</td><td>性能优化</td><td>分区裁剪优化</td></tr><tr><td>索引类型</td><td>B-tree, Hash</td><td>BRIN, SP-GiST</td><td>覆盖索引优化</td></tr></tbody></table><p><strong>重点注意事项</strong>：生产环境升级时，务必先在测试环境验证，特别注意13+版本对旧版本的兼容性变化，如默认身份验证方法从peer改为scram-sha-256。</p><hr><h2 id="第二部分：Debian-12环境下的PostgreSQL实战"><a href="#第二部分：Debian-12环境下的PostgreSQL实战" class="headerlink" title="第二部分：Debian 12环境下的PostgreSQL实战"></a>第二部分：Debian 12环境下的PostgreSQL实战</h2><h3 id="2-1-安装与基础配置"><a href="#2-1-安装与基础配置" class="headerlink" title="2.1 安装与基础配置"></a>2.1 安装与基础配置</h3><h4 id="2-1-1-安装PostgreSQL-16"><a href="#2-1-1-安装PostgreSQL-16" class="headerlink" title="2.1.1 安装PostgreSQL 16"></a>2.1.1 安装PostgreSQL 16</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 更新系统</span></span><br><span class="line">sudo apt update &amp;&amp; sudo apt upgrade -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加官方仓库</span></span><br><span class="line">sudo apt install -y curl ca-certificates</span><br><span class="line">curl https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo gpg --dearmor -o /usr/share/keyrings/postgresql.gpg</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;deb [signed-by=/usr/share/keyrings/postgresql.gpg] http://apt.postgresql.org/pub/repos/apt <span class="subst">$(lsb_release -cs)</span>-pgdg main&quot;</span> | sudo <span class="built_in">tee</span> /etc/apt/sources.list.d/pgdg.list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装PostgreSQL 16</span></span><br><span class="line">sudo apt update</span><br><span class="line">sudo apt install -y postgresql-16 postgresql-client-16 postgresql-contrib-16</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动服务</span></span><br><span class="line">sudo systemctl <span class="built_in">enable</span> postgresql@16-main</span><br><span class="line">sudo systemctl start postgresql@16-main</span><br></pre></td></tr></table></figure><p><strong>重要安全配置</strong>：安装完成后立即修改默认postgres用户的密码，并配置适当的访问控制。</p><h4 id="2-1-2-基础目录结构"><a href="#2-1-2-基础目录结构" class="headerlink" title="2.1.2 基础目录结构"></a>2.1.2 基础目录结构</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/etc/postgresql/16/main/          # 配置文件目录</span><br><span class="line">/var/lib/postgresql/16/main/       # 数据文件目录</span><br><span class="line">/var/log/postgresql/               # 日志文件目录</span><br><span class="line">/usr/lib/postgresql/16/bin/        # 可执行文件目录</span><br></pre></td></tr></table></figure><h3 id="2-2-核心原理与架构"><a href="#2-2-核心原理与架构" class="headerlink" title="2.2 核心原理与架构"></a>2.2 核心原理与架构</h3><h4 id="2-2-1-进程架构"><a href="#2-2-1-进程架构" class="headerlink" title="2.2.1 进程架构"></a>2.2.1 进程架构</h4><p>PostgreSQL采用多进程架构，主要进程包括：</p><ul><li><strong>Postmaster进程</strong>：主进程，负责监听连接和spawn子进程</li><li><strong>Backend进程</strong>：每个客户端连接对应一个backend进程</li><li><strong>Checkpointer进程</strong>：负责检查点操作</li><li><strong>WAL Writer进程</strong>：负责WAL日志写入</li><li><strong>Autovacuum进程</strong>：自动清理死元组</li><li><strong>Background Writer进程</strong>：后台写入脏页</li></ul><h4 id="2-2-2-存储结构"><a href="#2-2-2-存储结构" class="headerlink" title="2.2.2 存储结构"></a>2.2.2 存储结构</h4><ul><li><strong>表空间（Tablespace）</strong>：物理存储位置</li><li><strong>数据库（Database）</strong>：逻辑容器</li><li><strong>模式（Schema）</strong>：命名空间</li><li><strong>表（Table）</strong>：数据存储单位</li><li><strong>页面（Page）</strong>：8KB的基本IO单位</li></ul><p><strong>性能关键点</strong>：合理配置shared_buffers（通常为物理内存的25%）和work_mem（根据并发查询数调整）对性能至关重要。</p><h3 id="2-3-基础语法与高级特性"><a href="#2-3-基础语法与高级特性" class="headerlink" title="2.3 基础语法与高级特性"></a>2.3 基础语法与高级特性</h3><h4 id="2-3-1-基础CRUD操作"><a href="#2-3-1-基础CRUD操作" class="headerlink" title="2.3.1 基础CRUD操作"></a>2.3.1 基础CRUD操作</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建数据库</span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE demo_db OWNER postgres;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> users (</span><br><span class="line">    id SERIAL <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    email <span class="type">VARCHAR</span>(<span class="number">150</span>) <span class="keyword">UNIQUE</span>,</span><br><span class="line">    created_at <span class="type">TIMESTAMP</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">    is_active <span class="type">BOOLEAN</span> <span class="keyword">DEFAULT</span> <span class="literal">true</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入数据</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> users (name, email) <span class="keyword">VALUES</span> </span><br><span class="line">(<span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;zhangsan@example.com&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;李四&#x27;</span>, <span class="string">&#x27;lisi@example.com&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询数据</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> is_active <span class="operator">=</span> <span class="literal">true</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> created_at <span class="keyword">DESC</span> LIMIT <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 更新数据</span></span><br><span class="line"><span class="keyword">UPDATE</span> users <span class="keyword">SET</span> is_active <span class="operator">=</span> <span class="literal">false</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除数据</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> created_at <span class="operator">&lt;</span> NOW() <span class="operator">-</span> <span class="type">INTERVAL</span> <span class="string">&#x27;1 year&#x27;</span>;</span><br></pre></td></tr></table></figure><h4 id="2-3-2-高级特性实战"><a href="#2-3-2-高级特性实战" class="headerlink" title="2.3.2 高级特性实战"></a>2.3.2 高级特性实战</h4><p><strong>JSONB操作</strong>：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建JSONB字段表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> products (</span><br><span class="line">    id SERIAL <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    attributes JSONB</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入JSON数据</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> products (name, attributes) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;笔记本电脑&#x27;</span>, <span class="string">&#x27;&#123;&quot;brand&quot;: &quot;Dell&quot;, &quot;price&quot;: 8999, &quot;specs&quot;: &#123;&quot;cpu&quot;: &quot;i7&quot;, &quot;ram&quot;: &quot;16GB&quot;&#125;&#125;&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;智能手机&#x27;</span>, <span class="string">&#x27;&#123;&quot;brand&quot;: &quot;Apple&quot;, &quot;price&quot;: 6999, &quot;specs&quot;: &#123;&quot;storage&quot;: &quot;256GB&quot;, &quot;color&quot;: &quot;black&quot;&#125;&#125;&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- JSONB查询</span></span><br><span class="line"><span class="keyword">SELECT</span> name, attributes<span class="operator">-</span><span class="operator">&gt;&gt;</span><span class="string">&#x27;brand&#x27;</span> <span class="keyword">as</span> brand, attributes<span class="operator">-</span><span class="operator">&gt;</span><span class="string">&#x27;specs&#x27;</span><span class="operator">-</span><span class="operator">&gt;&gt;</span><span class="string">&#x27;cpu&#x27;</span> <span class="keyword">as</span> cpu</span><br><span class="line"><span class="keyword">FROM</span> products</span><br><span class="line"><span class="keyword">WHERE</span> attributes @<span class="operator">&gt;</span> <span class="string">&#x27;&#123;&quot;brand&quot;: &quot;Dell&quot;&#125;&#x27;</span>;</span><br></pre></td></tr></table></figure><p><strong>窗口函数</strong>：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 销售数据分析</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    department,</span><br><span class="line">    employee_name,</span><br><span class="line">    salary,</span><br><span class="line">    <span class="built_in">AVG</span>(salary) <span class="keyword">OVER</span> (<span class="keyword">PARTITION</span> <span class="keyword">BY</span> department) <span class="keyword">as</span> dept_avg_salary,</span><br><span class="line">    <span class="built_in">RANK</span>() <span class="keyword">OVER</span> (<span class="keyword">PARTITION</span> <span class="keyword">BY</span> department <span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span>) <span class="keyword">as</span> salary_rank</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure><p><strong>重点注意事项</strong>：使用JSONB时，建议为常用查询路径创建GIN索引；窗口函数在大数据量时可能影响性能，需要合理使用。</p><hr><h2 id="第三部分：从单体到集群的演进"><a href="#第三部分：从单体到集群的演进" class="headerlink" title="第三部分：从单体到集群的演进"></a>第三部分：从单体到集群的演进</h2><h3 id="3-1-单体架构优化"><a href="#3-1-单体架构优化" class="headerlink" title="3.1 单体架构优化"></a>3.1 单体架构优化</h3><h4 id="3-1-1-配置文件优化"><a href="#3-1-1-配置文件优化" class="headerlink" title="3.1.1 配置文件优化"></a>3.1.1 配置文件优化</h4><p>编辑 <code>/etc/postgresql/16/main/postgresql.conf</code>：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># 内存配置</span><br><span class="line">shared_buffers = 4GB                   # 物理内存的25%</span><br><span class="line">effective_cache_size = 12GB            # 物理内存的75%</span><br><span class="line">work_mem = 64MB                        # 每个排序操作的内存</span><br><span class="line">maintenance_work_mem = 512MB           # 维护操作内存</span><br><span class="line"></span><br><span class="line"># WAL配置</span><br><span class="line">wal_level = replica                    # 支持复制</span><br><span class="line">max_wal_senders = 10                   # 最大WAL发送进程数</span><br><span class="line">wal_keep_size = 1GB                    # 保留的WAL文件大小</span><br><span class="line"></span><br><span class="line"># 连接配置</span><br><span class="line">max_connections = 200                  # 最大连接数</span><br><span class="line">superuser_reserved_connections = 5     # 保留给超级用户的连接</span><br><span class="line"></span><br><span class="line"># 并行查询</span><br><span class="line">max_parallel_workers_per_gather = 4    # 每个查询的最大并行worker</span><br><span class="line">max_parallel_workers = 8               # 系统最大并行worker</span><br></pre></td></tr></table></figure><h4 id="3-1-2-性能监控"><a href="#3-1-2-性能监控" class="headerlink" title="3.1.2 性能监控"></a>3.1.2 性能监控</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 安装监控扩展</span></span><br><span class="line"><span class="keyword">CREATE</span> EXTENSION IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> pg_stat_statements;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看慢查询</span></span><br><span class="line"><span class="keyword">SELECT</span> query, calls, total_exec_time, <span class="keyword">rows</span> </span><br><span class="line"><span class="keyword">FROM</span> pg_stat_statements </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> total_exec_time <span class="keyword">DESC</span> </span><br><span class="line">LIMIT <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 索引使用情况</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    schemaname,</span><br><span class="line">    tablename,</span><br><span class="line">    indexname,</span><br><span class="line">    idx_scan <span class="keyword">as</span> index_scans,</span><br><span class="line">    idx_tup_read <span class="keyword">as</span> tuples_read</span><br><span class="line"><span class="keyword">FROM</span> pg_stat_user_indexes</span><br><span class="line"><span class="keyword">WHERE</span> schemaname <span class="operator">=</span> <span class="string">&#x27;public&#x27;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> idx_scan <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure><h3 id="3-2-主从复制配置"><a href="#3-2-主从复制配置" class="headerlink" title="3.2 主从复制配置"></a>3.2 主从复制配置</h3><h4 id="3-2-1-主服务器配置"><a href="#3-2-1-主服务器配置" class="headerlink" title="3.2.1 主服务器配置"></a>3.2.1 主服务器配置</h4><ol><li><p>修改主服务器postgresql.conf：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wal_level = replica</span><br><span class="line">max_wal_senders = 10</span><br><span class="line">wal_keep_size = 1GB</span><br></pre></td></tr></table></figure></li><li><p>配置pg_hba.conf：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 允许从服务器连接</span><br><span class="line">host    replication     replicator      192.168.1.101/32        scram-sha-256</span><br></pre></td></tr></table></figure></li><li><p>创建复制用户：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> ROLE replicator <span class="keyword">WITH</span> REPLICATION LOGIN PASSWORD <span class="string">&#x27;secure_password&#x27;</span>;</span><br></pre></td></tr></table></figure></li></ol><h4 id="3-2-2-从服务器配置"><a href="#3-2-2-从服务器配置" class="headerlink" title="3.2.2 从服务器配置"></a>3.2.2 从服务器配置</h4><ol><li><p>停止从服务器PostgreSQL服务</p></li><li><p>使用pg_basebackup同步数据：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -u postgres pg_basebackup -h 192.168.1.100 -U replicator -D /var/lib/postgresql/16/main -P -v -R -X stream</span><br></pre></td></tr></table></figure></li><li><p>修改recovery.conf（PostgreSQL 12+在postgresql.conf中配置）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">primary_conninfo = &#x27;host=192.168.1.100 port=5432 user=replicator password=secure_password&#x27;</span><br><span class="line">standby_mode = on</span><br></pre></td></tr></table></figure></li><li><p>启动从服务器</p></li></ol><p><strong>关键注意事项</strong>：主从复制延迟监控至关重要，使用<code>pg_stat_replication</code>视图实时监控复制状态，设置合理的监控告警阈值。</p><h3 id="3-3-集群部署方案"><a href="#3-3-集群部署方案" class="headerlink" title="3.3 集群部署方案"></a>3.3 集群部署方案</h3><h4 id="3-3-1-使用Patroni实现高可用"><a href="#3-3-1-使用Patroni实现高可用" class="headerlink" title="3.3.1 使用Patroni实现高可用"></a>3.3.1 使用Patroni实现高可用</h4><p>Patroni是一个基于etcd的PostgreSQL高可用解决方案：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># patroni.yml 配置示例</span></span><br><span class="line"><span class="attr">scope:</span> <span class="string">postgres-cluster</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">pg-node-1</span></span><br><span class="line"></span><br><span class="line"><span class="attr">restapi:</span></span><br><span class="line">  <span class="attr">listen:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">:8008</span></span><br><span class="line">  <span class="attr">connect_address:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.100</span><span class="string">:8008</span></span><br><span class="line"></span><br><span class="line"><span class="attr">etcd:</span></span><br><span class="line">  <span class="attr">hosts:</span> [<span class="string">&quot;192.168.1.200:2379&quot;</span>, <span class="string">&quot;192.168.1.201:2379&quot;</span>, <span class="string">&quot;192.168.1.202:2379&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="attr">bootstrap:</span></span><br><span class="line">  <span class="attr">dcs:</span></span><br><span class="line">    <span class="attr">ttl:</span> <span class="number">30</span></span><br><span class="line">    <span class="attr">loop_wait:</span> <span class="number">10</span></span><br><span class="line">    <span class="attr">retry_timeout:</span> <span class="number">10</span></span><br><span class="line">    <span class="attr">maximum_lag_on_failover:</span> <span class="number">1048576</span></span><br><span class="line">    <span class="attr">postgresql:</span></span><br><span class="line">      <span class="attr">use_pg_rewind:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line">        <span class="attr">wal_level:</span> <span class="string">replica</span></span><br><span class="line">        <span class="attr">hot_standby:</span> <span class="string">&quot;on&quot;</span></span><br><span class="line">        <span class="attr">max_connections:</span> <span class="number">200</span></span><br><span class="line">        <span class="attr">max_wal_senders:</span> <span class="number">10</span></span><br><span class="line">        <span class="attr">wal_keep_size:</span> <span class="string">1GB</span></span><br><span class="line"></span><br><span class="line"><span class="attr">postgresql:</span></span><br><span class="line">  <span class="attr">listen:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">:5432</span></span><br><span class="line">  <span class="attr">connect_address:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.100</span><span class="string">:5432</span></span><br><span class="line">  <span class="attr">data_dir:</span> <span class="string">/var/lib/postgresql/16/main</span></span><br><span class="line">  <span class="attr">bin_dir:</span> <span class="string">/usr/lib/postgresql/16/bin</span></span><br><span class="line">  <span class="attr">authentication:</span></span><br><span class="line">    <span class="attr">replication:</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">replicator</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">secure_password</span></span><br><span class="line">    <span class="attr">superuser:</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">postgres</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">super_secure_password</span></span><br></pre></td></tr></table></figure><p><strong>集群运维要点</strong>：定期进行故障切换演练，监控etcd集群健康状态，确保网络延迟在可接受范围内（通常&lt;10ms）。</p><hr><h2 id="第四部分：Docker容器化部署"><a href="#第四部分：Docker容器化部署" class="headerlink" title="第四部分：Docker容器化部署"></a>第四部分：Docker容器化部署</h2><h3 id="4-1-单容器部署"><a href="#4-1-单容器部署" class="headerlink" title="4.1 单容器部署"></a>4.1 单容器部署</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 拉取官方镜像</span></span><br><span class="line">docker pull postgres:16-alpine</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行容器</span></span><br><span class="line">docker run -d \</span><br><span class="line">  --name postgres-single \</span><br><span class="line">  -p 5432:5432 \</span><br><span class="line">  -e POSTGRES_USER=admin \</span><br><span class="line">  -e POSTGRES_PASSWORD=secure_password \</span><br><span class="line">  -e POSTGRES_DB=myapp \</span><br><span class="line">  -v postgres_data:/var/lib/postgresql/data \</span><br><span class="line">  -v ./init-scripts:/docker-entrypoint-initdb.d \</span><br><span class="line">  --restart unless-stopped \</span><br><span class="line">  postgres:16-alpine</span><br></pre></td></tr></table></figure><p><strong>init-scripts&#x2F;01-init.sql</strong>：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> app_config (</span><br><span class="line">    key <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">    <span class="keyword">value</span> TEXT,</span><br><span class="line">    updated_at <span class="type">TIMESTAMP</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> app_config (key, <span class="keyword">value</span>) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;app_name&#x27;</span>, <span class="string">&#x27;My Application&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;version&#x27;</span>, <span class="string">&#x27;1.0.0&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;maintenance_mode&#x27;</span>, <span class="string">&#x27;false&#x27;</span>);</span><br></pre></td></tr></table></figure><h3 id="4-2-Docker-Compose多容器编排"><a href="#4-2-Docker-Compose多容器编排" class="headerlink" title="4.2 Docker Compose多容器编排"></a>4.2 Docker Compose多容器编排</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker-compose.yml</span></span><br><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.8&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">postgres-primary:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">postgres:16-alpine</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">pg-primary</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">POSTGRES_USER:</span> <span class="string">replicator</span></span><br><span class="line">      <span class="attr">POSTGRES_PASSWORD:</span> <span class="string">replica_password</span></span><br><span class="line">      <span class="attr">POSTGRES_DB:</span> <span class="string">replication_db</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">pg_primary_data:/var/lib/postgresql/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./conf/postgresql.conf:/etc/postgresql/postgresql.conf</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;5432:5432&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">pg-network</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">postgres-replica:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">postgres:16-alpine</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">pg-replica</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">POSTGRES_USER:</span> <span class="string">replicator</span></span><br><span class="line">      <span class="attr">POSTGRES_PASSWORD:</span> <span class="string">replica_password</span></span><br><span class="line">      <span class="attr">POSTGRES_DB:</span> <span class="string">replication_db</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">pg_replica_data:/var/lib/postgresql/data</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">postgres-primary</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">pg-network</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">pgadmin:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">dpage/pgadmin4</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">pgadmin</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">PGADMIN_DEFAULT_EMAIL:</span> <span class="string">admin@example.com</span></span><br><span class="line">      <span class="attr">PGADMIN_DEFAULT_PASSWORD:</span> <span class="string">pgadmin_password</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8080:80&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">pg-network</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">pg_primary_data:</span></span><br><span class="line">  <span class="attr">pg_replica_data:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">pg-network:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">bridge</span></span><br></pre></td></tr></table></figure><h3 id="4-3-集群容器化方案"><a href="#4-3-集群容器化方案" class="headerlink" title="4.3 集群容器化方案"></a>4.3 集群容器化方案</h3><p>使用Docker Swarm或Kubernetes部署PostgreSQL集群：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># kubernetes-postgres-statefulset.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">postgres</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">serviceName:</span> <span class="string">postgres</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">postgres</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">postgres</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">postgres</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">postgres:16-alpine</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">POSTGRES_USER</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">&quot;postgres&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">POSTGRES_PASSWORD</span></span><br><span class="line">          <span class="attr">valueFrom:</span></span><br><span class="line">            <span class="attr">secretKeyRef:</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">postgres-secret</span></span><br><span class="line">              <span class="attr">key:</span> <span class="string">password</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">5432</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">postgres-storage</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/var/lib/postgresql/data</span></span><br><span class="line">  <span class="attr">volumeClaimTemplates:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">postgres-storage</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">accessModes:</span> [ <span class="string">&quot;ReadWriteOnce&quot;</span> ]</span><br><span class="line">      <span class="attr">storageClassName:</span> <span class="string">&quot;standard&quot;</span></span><br><span class="line">      <span class="attr">resources:</span></span><br><span class="line">        <span class="attr">requests:</span></span><br><span class="line">          <span class="attr">storage:</span> <span class="string">100Gi</span></span><br></pre></td></tr></table></figure><p><strong>容器化注意事项</strong>：</p><ul><li>生产环境务必使用持久化卷，避免数据丢失</li><li>合理配置资源限制（CPU、内存）</li><li>使用secret管理敏感信息</li><li>定期备份容器内数据</li></ul><hr><h2 id="第五部分：多语言应用开发实战"><a href="#第五部分：多语言应用开发实战" class="headerlink" title="第五部分：多语言应用开发实战"></a>第五部分：多语言应用开发实战</h2><h3 id="5-1-PHP操作PostgreSQL"><a href="#5-1-PHP操作PostgreSQL" class="headerlink" title="5.1 PHP操作PostgreSQL"></a>5.1 PHP操作PostgreSQL</h3><h4 id="5-1-1-环境配置"><a href="#5-1-1-环境配置" class="headerlink" title="5.1.1 环境配置"></a>5.1.1 环境配置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装PHP PostgreSQL扩展</span></span><br><span class="line">sudo apt install -y php-pgsql</span><br><span class="line">sudo systemctl restart apache2</span><br></pre></td></tr></table></figure><h4 id="5-1-2-完整示例"><a href="#5-1-2-完整示例" class="headerlink" title="5.1.2 完整示例"></a>5.1.2 完整示例</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * PostgreSQL PHP操作完整示例</span></span><br><span class="line"><span class="comment"> * 包含连接池、事务、预处理语句等最佳实践</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PostgreSQLService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$connection</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$config</span> = [</span><br><span class="line">        <span class="string">&#x27;host&#x27;</span> =&gt; <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;port&#x27;</span> =&gt; <span class="number">5432</span>,</span><br><span class="line">        <span class="string">&#x27;dbname&#x27;</span> =&gt; <span class="string">&#x27;myapp&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;user&#x27;</span> =&gt; <span class="string">&#x27;app_user&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;password&#x27;</span> =&gt; <span class="string">&#x27;secure_password&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;options&#x27;</span> =&gt; <span class="string">&#x27;--client_encoding=UTF8&#x27;</span></span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">connect</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">connect</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$dsn</span> = <span class="title function_ invoke__">sprintf</span>(</span><br><span class="line">            <span class="string">&quot;pgsql:host=%s;port=%s;dbname=%s;options=&#x27;%s&#x27;&quot;</span>,</span><br><span class="line">            <span class="variable">$this</span>-&gt;config[<span class="string">&#x27;host&#x27;</span>],</span><br><span class="line">            <span class="variable">$this</span>-&gt;config[<span class="string">&#x27;port&#x27;</span>],</span><br><span class="line">            <span class="variable">$this</span>-&gt;config[<span class="string">&#x27;dbname&#x27;</span>],</span><br><span class="line">            <span class="variable">$this</span>-&gt;config[<span class="string">&#x27;options&#x27;</span>]</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;connection = <span class="keyword">new</span> <span class="title function_ invoke__">PDO</span>(<span class="variable">$dsn</span>, <span class="variable">$this</span>-&gt;config[<span class="string">&#x27;user&#x27;</span>], <span class="variable">$this</span>-&gt;config[<span class="string">&#x27;password&#x27;</span>], [</span><br><span class="line">                PDO::<span class="variable constant_">ATTR_ERRMODE</span> =&gt; PDO::<span class="variable constant_">ERRMODE_EXCEPTION</span>,</span><br><span class="line">                PDO::<span class="variable constant_">ATTR_DEFAULT_FETCH_MODE</span> =&gt; PDO::<span class="variable constant_">FETCH_ASSOC</span>,</span><br><span class="line">                PDO::<span class="variable constant_">ATTR_EMULATE_PREPARES</span> =&gt; <span class="literal">false</span></span><br><span class="line">            ]);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (PDOException <span class="variable">$e</span>) &#123;</span><br><span class="line">            <span class="title function_ invoke__">error_log</span>(<span class="string">&quot;Database connection failed: &quot;</span> . <span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>());</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;Database connection failed&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建用户</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">createUser</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$email</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$query</span> = <span class="string">&quot;INSERT INTO users (name, email, created_at) VALUES (?, ?, NOW()) RETURNING id&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="variable">$stmt</span> = <span class="variable language_">$this</span>-&gt;connection-&gt;<span class="title function_ invoke__">prepare</span>(<span class="variable">$query</span>);</span><br><span class="line">            <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">execute</span>([<span class="variable">$name</span>, <span class="variable">$email</span>]);</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">fetchColumn</span>();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (PDOException <span class="variable">$e</span>) &#123;</span><br><span class="line">            <span class="title function_ invoke__">error_log</span>(<span class="string">&quot;Create user failed: &quot;</span> . <span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>());</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;Failed to create user&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取用户详情</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getUser</span>(<span class="params"><span class="variable">$userId</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$query</span> = <span class="string">&quot;SELECT id, name, email, created_at FROM users WHERE id = ? AND is_active = true&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="variable">$stmt</span> = <span class="variable language_">$this</span>-&gt;connection-&gt;<span class="title function_ invoke__">prepare</span>(<span class="variable">$query</span>);</span><br><span class="line">            <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">execute</span>([<span class="variable">$userId</span>]);</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">fetch</span>();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (PDOException <span class="variable">$e</span>) &#123;</span><br><span class="line">            <span class="title function_ invoke__">error_log</span>(<span class="string">&quot;Get user failed: &quot;</span> . <span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>());</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取用户列表（分页）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getUserList</span>(<span class="params"><span class="variable">$page</span> = <span class="number">1</span>, <span class="variable">$pageSize</span> = <span class="number">20</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$offset</span> = (<span class="variable">$page</span> - <span class="number">1</span>) * <span class="variable">$pageSize</span>;</span><br><span class="line">        <span class="variable">$query</span> = <span class="string">&quot;SELECT id, name, email, created_at FROM users WHERE is_active = true ORDER BY created_at DESC LIMIT ? OFFSET ?&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="variable">$stmt</span> = <span class="variable language_">$this</span>-&gt;connection-&gt;<span class="title function_ invoke__">prepare</span>(<span class="variable">$query</span>);</span><br><span class="line">            <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">execute</span>([<span class="variable">$pageSize</span>, <span class="variable">$offset</span>]);</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">fetchAll</span>();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (PDOException <span class="variable">$e</span>) &#123;</span><br><span class="line">            <span class="title function_ invoke__">error_log</span>(<span class="string">&quot;Get user list failed: &quot;</span> . <span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>());</span><br><span class="line">            <span class="keyword">return</span> [];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 事务操作示例</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">transferMoney</span>(<span class="params"><span class="variable">$fromUserId</span>, <span class="variable">$toUserId</span>, <span class="variable">$amount</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;connection-&gt;<span class="title function_ invoke__">beginTransaction</span>();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 检查余额</span></span><br><span class="line">            <span class="variable">$checkQuery</span> = <span class="string">&quot;SELECT balance FROM accounts WHERE user_id = ? FOR UPDATE&quot;</span>;</span><br><span class="line">            <span class="variable">$stmt</span> = <span class="variable language_">$this</span>-&gt;connection-&gt;<span class="title function_ invoke__">prepare</span>(<span class="variable">$checkQuery</span>);</span><br><span class="line">            <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">execute</span>([<span class="variable">$fromUserId</span>]);</span><br><span class="line">            <span class="variable">$fromBalance</span> = <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">fetchColumn</span>();</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$fromBalance</span> &lt; <span class="variable">$amount</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;Insufficient balance&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 扣款</span></span><br><span class="line">            <span class="variable">$debitQuery</span> = <span class="string">&quot;UPDATE accounts SET balance = balance - ? WHERE user_id = ?&quot;</span>;</span><br><span class="line">            <span class="variable">$stmt</span> = <span class="variable language_">$this</span>-&gt;connection-&gt;<span class="title function_ invoke__">prepare</span>(<span class="variable">$debitQuery</span>);</span><br><span class="line">            <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">execute</span>([<span class="variable">$amount</span>, <span class="variable">$fromUserId</span>]);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 入账</span></span><br><span class="line">            <span class="variable">$creditQuery</span> = <span class="string">&quot;UPDATE accounts SET balance = balance + ? WHERE user_id = ?&quot;</span>;</span><br><span class="line">            <span class="variable">$stmt</span> = <span class="variable language_">$this</span>-&gt;connection-&gt;<span class="title function_ invoke__">prepare</span>(<span class="variable">$creditQuery</span>);</span><br><span class="line">            <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">execute</span>([<span class="variable">$amount</span>, <span class="variable">$toUserId</span>]);</span><br><span class="line">            </span><br><span class="line">            <span class="variable language_">$this</span>-&gt;connection-&gt;<span class="title function_ invoke__">commit</span>();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="built_in">Exception</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;connection-&gt;<span class="title function_ invoke__">rollBack</span>();</span><br><span class="line">            <span class="title function_ invoke__">error_log</span>(<span class="string">&quot;Transaction failed: &quot;</span> . <span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>());</span><br><span class="line">            <span class="keyword">throw</span> <span class="variable">$e</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * JSONB数据操作</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">updateUserProfile</span>(<span class="params"><span class="variable">$userId</span>, <span class="keyword">array</span> <span class="variable">$profileData</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$jsonData</span> = <span class="title function_ invoke__">json_encode</span>(<span class="variable">$profileData</span>, JSON_UNESCAPED_UNICODE);</span><br><span class="line">        <span class="variable">$query</span> = <span class="string">&quot;UPDATE users SET profile_data = ?::jsonb WHERE id = ?&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="variable">$stmt</span> = <span class="variable language_">$this</span>-&gt;connection-&gt;<span class="title function_ invoke__">prepare</span>(<span class="variable">$query</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">execute</span>([<span class="variable">$jsonData</span>, <span class="variable">$userId</span>]);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (PDOException <span class="variable">$e</span>) &#123;</span><br><span class="line">            <span class="title function_ invoke__">error_log</span>(<span class="string">&quot;Update profile failed: &quot;</span> . <span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>());</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;connection = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="variable">$db</span> = <span class="keyword">new</span> <span class="title class_">PostgreSQLService</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建用户</span></span><br><span class="line">    <span class="variable">$userId</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">createUser</span>(<span class="string">&#x27;王五&#x27;</span>, <span class="string">&#x27;wangwu@example.com&#x27;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Created user with ID: <span class="subst">$userId</span>\n&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取用户</span></span><br><span class="line">    <span class="variable">$user</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">getUser</span>(<span class="variable">$userId</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$user</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;User found: &quot;</span> . <span class="title function_ invoke__">print_r</span>(<span class="variable">$user</span>, <span class="literal">true</span>) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 事务操作</span></span><br><span class="line">    <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">transferMoney</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">100.00</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Money transfer successful\n&quot;</span>;</span><br><span class="line">    </span><br><span class="line">&#125; <span class="keyword">catch</span> (<span class="built_in">Exception</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Error: &quot;</span> . <span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>() . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-2-Golang操作PostgreSQL"><a href="#5-2-Golang操作PostgreSQL" class="headerlink" title="5.2 Golang操作PostgreSQL"></a>5.2 Golang操作PostgreSQL</h3><h4 id="5-2-1-依赖安装"><a href="#5-2-1-依赖安装" class="headerlink" title="5.2.1 依赖安装"></a>5.2.1 依赖安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">go get github.com/jackc/pgx/v5</span><br><span class="line">go get github.com/jackc/pgx/v5/pgxpool</span><br></pre></td></tr></table></figure><h4 id="5-2-2-完整示例"><a href="#5-2-2-完整示例" class="headerlink" title="5.2.2 完整示例"></a>5.2.2 完整示例</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;github.com/jackc/pgx/v5&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/jackc/pgx/v5/pgxpool&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数据库配置</span></span><br><span class="line"><span class="keyword">type</span> DBConfig <span class="keyword">struct</span> &#123;</span><br><span class="line">	Host     <span class="type">string</span></span><br><span class="line">	Port     <span class="type">int</span></span><br><span class="line">	User     <span class="type">string</span></span><br><span class="line">	Password <span class="type">string</span></span><br><span class="line">	Database <span class="type">string</span></span><br><span class="line">	MaxConns <span class="type">int32</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 用户模型</span></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">	ID        <span class="type">int64</span>     <span class="string">`json:&quot;id&quot;`</span></span><br><span class="line">	Name      <span class="type">string</span>    <span class="string">`json:&quot;name&quot;`</span></span><br><span class="line">	Email     <span class="type">string</span>    <span class="string">`json:&quot;email&quot;`</span></span><br><span class="line">	CreatedAt time.Time <span class="string">`json:&quot;created_at&quot;`</span></span><br><span class="line">	IsActive  <span class="type">bool</span>      <span class="string">`json:&quot;is_active&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// PostgreSQL服务</span></span><br><span class="line"><span class="keyword">type</span> PostgreSQLService <span class="keyword">struct</span> &#123;</span><br><span class="line">	pool *pgxpool.Pool</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化数据库连接</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewPostgreSQLService</span><span class="params">(config *DBConfig)</span></span> (*PostgreSQLService, <span class="type">error</span>) &#123;</span><br><span class="line">	connStr := fmt.Sprintf(<span class="string">&quot;postgres://%s:%s@%s:%d/%s?pool_max_conns=%d&quot;</span>,</span><br><span class="line">		config.User,</span><br><span class="line">		config.Password,</span><br><span class="line">		config.Host,</span><br><span class="line">		config.Port,</span><br><span class="line">		config.Database,</span><br><span class="line">		config.MaxConns)</span><br><span class="line"></span><br><span class="line">	pool, err := pgxpool.New(context.Background(), connStr)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">&quot;failed to create connection pool: %w&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 测试连接</span></span><br><span class="line">	<span class="keyword">if</span> err := pool.Ping(context.Background()); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		pool.Close()</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">&quot;failed to ping database: %w&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> &amp;PostgreSQLService&#123;pool: pool&#125;, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关闭连接池</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *PostgreSQLService)</span></span> Close() &#123;</span><br><span class="line">	s.pool.Close()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建用户</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *PostgreSQLService)</span></span> CreateUser(ctx context.Context, name, email <span class="type">string</span>) (<span class="type">int64</span>, <span class="type">error</span>) &#123;</span><br><span class="line">	<span class="keyword">var</span> userID <span class="type">int64</span></span><br><span class="line">	err := s.pool.QueryRow(ctx, <span class="string">`</span></span><br><span class="line"><span class="string">		INSERT INTO users (name, email, created_at, is_active)</span></span><br><span class="line"><span class="string">		VALUES ($1, $2, NOW(), true)</span></span><br><span class="line"><span class="string">		RETURNING id</span></span><br><span class="line"><span class="string">	`</span>, name, email).Scan(&amp;userID)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> userID, err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取用户</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *PostgreSQLService)</span></span> GetUser(ctx context.Context, userID <span class="type">int64</span>) (*User, <span class="type">error</span>) &#123;</span><br><span class="line">	user := &amp;User&#123;&#125;</span><br><span class="line">	err := s.pool.QueryRow(ctx, <span class="string">`</span></span><br><span class="line"><span class="string">		SELECT id, name, email, created_at, is_active</span></span><br><span class="line"><span class="string">		FROM users</span></span><br><span class="line"><span class="string">		WHERE id = $1 AND is_active = true</span></span><br><span class="line"><span class="string">	`</span>, userID).Scan(</span><br><span class="line">		&amp;user.ID,</span><br><span class="line">		&amp;user.Name,</span><br><span class="line">		&amp;user.Email,</span><br><span class="line">		&amp;user.CreatedAt,</span><br><span class="line">		&amp;user.IsActive,</span><br><span class="line">	)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> err == pgx.ErrNoRows &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">nil</span>, <span class="literal">nil</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> user, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取用户列表</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *PostgreSQLService)</span></span> GetUserList(ctx context.Context, page, pageSize <span class="type">int</span>) ([]User, <span class="type">error</span>) &#123;</span><br><span class="line">	offset := (page - <span class="number">1</span>) * pageSize</span><br><span class="line">	rows, err := s.pool.Query(ctx, <span class="string">`</span></span><br><span class="line"><span class="string">		SELECT id, name, email, created_at, is_active</span></span><br><span class="line"><span class="string">		FROM users</span></span><br><span class="line"><span class="string">		WHERE is_active = true</span></span><br><span class="line"><span class="string">		ORDER BY created_at DESC</span></span><br><span class="line"><span class="string">		LIMIT $1 OFFSET $2</span></span><br><span class="line"><span class="string">	`</span>, pageSize, offset)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> rows.Close()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> users []User</span><br><span class="line">	<span class="keyword">for</span> rows.Next() &#123;</span><br><span class="line">		<span class="keyword">var</span> user User</span><br><span class="line">		<span class="keyword">if</span> err := rows.Scan(</span><br><span class="line">			&amp;user.ID,</span><br><span class="line">			&amp;user.Name,</span><br><span class="line">			&amp;user.Email,</span><br><span class="line">			&amp;user.CreatedAt,</span><br><span class="line">			&amp;user.IsActive,</span><br><span class="line">		); err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">		&#125;</span><br><span class="line">		users = <span class="built_in">append</span>(users, user)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> users, rows.Err()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 事务操作</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *PostgreSQLService)</span></span> TransferMoney(ctx context.Context, fromUserID, toUserID <span class="type">int64</span>, amount <span class="type">float64</span>) <span class="type">error</span> &#123;</span><br><span class="line">	tx, err := s.pool.Begin(ctx)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			tx.Rollback(ctx)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 检查余额</span></span><br><span class="line">	<span class="keyword">var</span> fromBalance <span class="type">float64</span></span><br><span class="line">	err = tx.QueryRow(ctx, <span class="string">`</span></span><br><span class="line"><span class="string">		SELECT balance FROM accounts WHERE user_id = $1 FOR UPDATE</span></span><br><span class="line"><span class="string">	`</span>, fromUserID).Scan(&amp;fromBalance)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> err</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> fromBalance &lt; amount &#123;</span><br><span class="line">		<span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;insufficient balance&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 扣款</span></span><br><span class="line">	_, err = tx.Exec(ctx, <span class="string">`</span></span><br><span class="line"><span class="string">		UPDATE accounts SET balance = balance - $1 WHERE user_id = $2</span></span><br><span class="line"><span class="string">	`</span>, amount, fromUserID)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> err</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 入账</span></span><br><span class="line">	_, err = tx.Exec(ctx, <span class="string">`</span></span><br><span class="line"><span class="string">		UPDATE accounts SET balance = balance + $1 WHERE user_id = $2</span></span><br><span class="line"><span class="string">	`</span>, amount, toUserID)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> err</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> tx.Commit(ctx)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// JSONB数据操作</span></span><br><span class="line"><span class="keyword">type</span> UserProfile <span class="keyword">struct</span> &#123;</span><br><span class="line">	Age      <span class="type">int</span>      <span class="string">`json:&quot;age&quot;`</span></span><br><span class="line">	City     <span class="type">string</span>   <span class="string">`json:&quot;city&quot;`</span></span><br><span class="line">	Hobbies  []<span class="type">string</span> <span class="string">`json:&quot;hobbies&quot;`</span></span><br><span class="line">	Settings <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125; <span class="string">`json:&quot;settings&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *PostgreSQLService)</span></span> UpdateUserProfile(ctx context.Context, userID <span class="type">int64</span>, profile *UserProfile) <span class="type">error</span> &#123;</span><br><span class="line">	_, err := s.pool.Exec(ctx, <span class="string">`</span></span><br><span class="line"><span class="string">		UPDATE users </span></span><br><span class="line"><span class="string">		SET profile_data = $1::jsonb </span></span><br><span class="line"><span class="string">		WHERE id = $2</span></span><br><span class="line"><span class="string">	`</span>, profile, userID)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 配置</span></span><br><span class="line">	config := &amp;DBConfig&#123;</span><br><span class="line">		Host:     <span class="string">&quot;localhost&quot;</span>,</span><br><span class="line">		Port:     <span class="number">5432</span>,</span><br><span class="line">		User:     <span class="string">&quot;app_user&quot;</span>,</span><br><span class="line">		Password: <span class="string">&quot;secure_password&quot;</span>,</span><br><span class="line">		Database: <span class="string">&quot;myapp&quot;</span>,</span><br><span class="line">		MaxConns: <span class="number">20</span>,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 初始化服务</span></span><br><span class="line">	service, err := NewPostgreSQLService(config)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalf(<span class="string">&quot;Failed to initialize database: %v&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> service.Close()</span><br><span class="line"></span><br><span class="line">	ctx := context.Background()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建用户</span></span><br><span class="line">	userID, err := service.CreateUser(ctx, <span class="string">&quot;赵六&quot;</span>, <span class="string">&quot;zhaoliu@example.com&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalf(<span class="string">&quot;Failed to create user: %v&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;Created user with ID: %d\n&quot;</span>, userID)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 获取用户</span></span><br><span class="line">	user, err := service.GetUser(ctx, userID)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalf(<span class="string">&quot;Failed to get user: %v&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> user != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;User found: %+v\n&quot;</span>, user)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 事务操作</span></span><br><span class="line">	err = service.TransferMoney(ctx, <span class="number">1</span>, <span class="number">2</span>, <span class="number">150.00</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Printf(<span class="string">&quot;Transfer failed: %v&quot;</span>, err)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;Money transfer successful&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">&quot;Operation completed successfully&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-3-Python操作PostgreSQL"><a href="#5-3-Python操作PostgreSQL" class="headerlink" title="5.3 Python操作PostgreSQL"></a>5.3 Python操作PostgreSQL</h3><h4 id="5-3-1-依赖安装"><a href="#5-3-1-依赖安装" class="headerlink" title="5.3.1 依赖安装"></a>5.3.1 依赖安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install psycopg[binary,pool] SQLAlchemy</span><br></pre></td></tr></table></figure><h4 id="5-3-2-完整示例"><a href="#5-3-2-完整示例" class="headerlink" title="5.3.2 完整示例"></a>5.3.2 完整示例</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">from</span> contextlib <span class="keyword">import</span> contextmanager</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime, timedelta</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Dict</span>, <span class="type">Optional</span>, <span class="type">Any</span>, <span class="type">Tuple</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> psycopg</span><br><span class="line"><span class="keyword">from</span> psycopg <span class="keyword">import</span> sql</span><br><span class="line"><span class="keyword">from</span> psycopg.pool <span class="keyword">import</span> ConnectionPool</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置日志</span></span><br><span class="line">logging.basicConfig(level=logging.INFO, <span class="built_in">format</span>=<span class="string">&#x27;%(asctime)s - %(name)s - %(levelname)s - %(message)s&#x27;</span>)</span><br><span class="line">logger = logging.getLogger(<span class="string">&#x27;postgres_demo&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PostgreSQLService</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, config: <span class="built_in">dict</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        初始化PostgreSQL连接池</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        :param config: 数据库配置字典</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        self.config = config</span><br><span class="line">        self.pool = <span class="literal">None</span></span><br><span class="line">        self._initialize_pool()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_initialize_pool</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;初始化连接池&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            conninfo = <span class="string">f&quot;host=<span class="subst">&#123;self.config[<span class="string">&#x27;host&#x27;</span>]&#125;</span> port=<span class="subst">&#123;self.config[<span class="string">&#x27;port&#x27;</span>]&#125;</span> &quot;</span> \</span><br><span class="line">                       <span class="string">f&quot;dbname=<span class="subst">&#123;self.config[<span class="string">&#x27;dbname&#x27;</span>]&#125;</span> user=<span class="subst">&#123;self.config[<span class="string">&#x27;user&#x27;</span>]&#125;</span> &quot;</span> \</span><br><span class="line">                       <span class="string">f&quot;password=<span class="subst">&#123;self.config[<span class="string">&#x27;password&#x27;</span>]&#125;</span> sslmode=<span class="subst">&#123;self.config.get(<span class="string">&#x27;sslmode&#x27;</span>, <span class="string">&#x27;prefer&#x27;</span>)&#125;</span>&quot;</span></span><br><span class="line">            </span><br><span class="line">            self.pool = ConnectionPool(</span><br><span class="line">                conninfo=conninfo,</span><br><span class="line">                min_size=self.config.get(<span class="string">&#x27;min_size&#x27;</span>, <span class="number">5</span>),</span><br><span class="line">                max_size=self.config.get(<span class="string">&#x27;max_size&#x27;</span>, <span class="number">20</span>),</span><br><span class="line">                <span class="built_in">open</span>=<span class="literal">True</span>,</span><br><span class="line">                configure=self._configure_connection</span><br><span class="line">            )</span><br><span class="line">            logger.info(<span class="string">&quot;Database connection pool initialized successfully&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            logger.error(<span class="string">f&quot;Failed to initialize connection pool: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">raise</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_configure_connection</span>(<span class="params">self, conn: psycopg.Connection</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;配置连接&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">with</span> conn.cursor() <span class="keyword">as</span> cur:</span><br><span class="line">            <span class="comment"># 设置时区</span></span><br><span class="line">            cur.execute(<span class="string">&quot;SET TIME ZONE &#x27;UTC&#x27;&quot;</span>)</span><br><span class="line">            <span class="comment"># 设置客户端编码</span></span><br><span class="line">            cur.execute(<span class="string">&quot;SET CLIENT_ENCODING TO &#x27;UTF8&#x27;&quot;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @contextmanager</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_connection</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;获取连接上下文管理器&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.pool:</span><br><span class="line">            <span class="keyword">raise</span> Exception(<span class="string">&quot;Connection pool not initialized&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        conn = self.pool.getconn()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">yield</span> conn</span><br><span class="line">            conn.commit()</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            conn.rollback()</span><br><span class="line">            logger.error(<span class="string">f&quot;Database operation failed: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">raise</span></span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            self.pool.putconn(conn)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_user</span>(<span class="params">self, name: <span class="built_in">str</span>, email: <span class="built_in">str</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;创建用户&quot;&quot;&quot;</span></span><br><span class="line">        query = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        INSERT INTO users (name, email, created_at, is_active)</span></span><br><span class="line"><span class="string">        VALUES (%s, %s, NOW(), true)</span></span><br><span class="line"><span class="string">        RETURNING id</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">with</span> self.get_connection() <span class="keyword">as</span> conn:</span><br><span class="line">                <span class="keyword">with</span> conn.cursor() <span class="keyword">as</span> cur:</span><br><span class="line">                    cur.execute(query, (name, email))</span><br><span class="line">                    user_id = cur.fetchone()[<span class="number">0</span>]</span><br><span class="line">                    logger.info(<span class="string">f&quot;Created user <span class="subst">&#123;name&#125;</span> with ID <span class="subst">&#123;user_id&#125;</span>&quot;</span>)</span><br><span class="line">                    <span class="keyword">return</span> user_id</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            logger.error(<span class="string">f&quot;Failed to create user: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">raise</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_user</span>(<span class="params">self, user_id: <span class="built_in">int</span></span>) -&gt; <span class="type">Optional</span>[<span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;获取用户信息&quot;&quot;&quot;</span></span><br><span class="line">        query = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        SELECT id, name, email, created_at, is_active</span></span><br><span class="line"><span class="string">        FROM users</span></span><br><span class="line"><span class="string">        WHERE id = %s AND is_active = true</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">with</span> self.get_connection() <span class="keyword">as</span> conn:</span><br><span class="line">                <span class="keyword">with</span> conn.cursor(row_factory=psycopg.rows.dict_row) <span class="keyword">as</span> cur:</span><br><span class="line">                    cur.execute(query, (user_id,))</span><br><span class="line">                    <span class="keyword">return</span> cur.fetchone()</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            logger.error(<span class="string">f&quot;Failed to get user: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">raise</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_user_list</span>(<span class="params">self, page: <span class="built_in">int</span> = <span class="number">1</span>, page_size: <span class="built_in">int</span> = <span class="number">20</span></span>) -&gt; <span class="type">List</span>[<span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;获取用户列表（分页）&quot;&quot;&quot;</span></span><br><span class="line">        offset = (page - <span class="number">1</span>) * page_size</span><br><span class="line">        query = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        SELECT id, name, email, created_at, is_active</span></span><br><span class="line"><span class="string">        FROM users</span></span><br><span class="line"><span class="string">        WHERE is_active = true</span></span><br><span class="line"><span class="string">        ORDER BY created_at DESC</span></span><br><span class="line"><span class="string">        LIMIT %s OFFSET %s</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">with</span> self.get_connection() <span class="keyword">as</span> conn:</span><br><span class="line">                <span class="keyword">with</span> conn.cursor(row_factory=psycopg.rows.dict_row) <span class="keyword">as</span> cur:</span><br><span class="line">                    cur.execute(query, (page_size, offset))</span><br><span class="line">                    <span class="keyword">return</span> cur.fetchall()</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            logger.error(<span class="string">f&quot;Failed to get user list: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">raise</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">transfer_money</span>(<span class="params">self, from_user_id: <span class="built_in">int</span>, to_user_id: <span class="built_in">int</span>, amount: <span class="built_in">float</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;转账操作（事务）&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">with</span> self.get_connection() <span class="keyword">as</span> conn:</span><br><span class="line">                <span class="keyword">with</span> conn.transaction():</span><br><span class="line">                    <span class="comment"># 检查余额</span></span><br><span class="line">                    check_query = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                    SELECT balance FROM accounts WHERE user_id = %s FOR UPDATE</span></span><br><span class="line"><span class="string">                    &quot;&quot;&quot;</span></span><br><span class="line">                    <span class="keyword">with</span> conn.cursor() <span class="keyword">as</span> cur:</span><br><span class="line">                        cur.execute(check_query, (from_user_id,))</span><br><span class="line">                        result = cur.fetchone()</span><br><span class="line">                        </span><br><span class="line">                        <span class="keyword">if</span> <span class="keyword">not</span> result:</span><br><span class="line">                            <span class="keyword">raise</span> ValueError(<span class="string">f&quot;Account not found for user <span class="subst">&#123;from_user_id&#125;</span>&quot;</span>)</span><br><span class="line">                        </span><br><span class="line">                        balance = result[<span class="number">0</span>]</span><br><span class="line">                        <span class="keyword">if</span> balance &lt; amount:</span><br><span class="line">                            <span class="keyword">raise</span> ValueError(<span class="string">&quot;Insufficient balance&quot;</span>)</span><br><span class="line">                        </span><br><span class="line">                        <span class="comment"># 扣款</span></span><br><span class="line">                        debit_query = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                        UPDATE accounts SET balance = balance - %s WHERE user_id = %s</span></span><br><span class="line"><span class="string">                        &quot;&quot;&quot;</span></span><br><span class="line">                        cur.execute(debit_query, (amount, from_user_id))</span><br><span class="line">                        </span><br><span class="line">                        <span class="comment"># 入账</span></span><br><span class="line">                        credit_query = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                        UPDATE accounts SET balance = balance + %s WHERE user_id = %s</span></span><br><span class="line"><span class="string">                        &quot;&quot;&quot;</span></span><br><span class="line">                        cur.execute(credit_query, (amount, to_user_id))</span><br><span class="line">                        </span><br><span class="line">                        <span class="comment"># 记录交易日志</span></span><br><span class="line">                        log_query = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                        INSERT INTO transactions (from_user_id, to_user_id, amount, created_at)</span></span><br><span class="line"><span class="string">                        VALUES (%s, %s, %s, NOW())</span></span><br><span class="line"><span class="string">                        &quot;&quot;&quot;</span></span><br><span class="line">                        cur.execute(log_query, (from_user_id, to_user_id, amount))</span><br><span class="line">            </span><br><span class="line">            logger.info(<span class="string">f&quot;Transferred <span class="subst">&#123;amount&#125;</span> from user <span class="subst">&#123;from_user_id&#125;</span> to user <span class="subst">&#123;to_user_id&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">            </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            logger.error(<span class="string">f&quot;Transfer failed: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">raise</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update_user_profile</span>(<span class="params">self, user_id: <span class="built_in">int</span>, profile_data: <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]</span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;更新用户JSONB资料&quot;&quot;&quot;</span></span><br><span class="line">        query = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        UPDATE users </span></span><br><span class="line"><span class="string">        SET profile_data = %s::jsonb </span></span><br><span class="line"><span class="string">        WHERE id = %s</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            json_data = json.dumps(profile_data, ensure_ascii=<span class="literal">False</span>)</span><br><span class="line">            <span class="keyword">with</span> self.get_connection() <span class="keyword">as</span> conn:</span><br><span class="line">                <span class="keyword">with</span> conn.cursor() <span class="keyword">as</span> cur:</span><br><span class="line">                    cur.execute(query, (json_data, user_id))</span><br><span class="line">                    <span class="keyword">return</span> cur.rowcount &gt; <span class="number">0</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            logger.error(<span class="string">f&quot;Failed to update user profile: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">raise</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">search_users_by_profile</span>(<span class="params">self, criteria: <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]</span>) -&gt; <span class="type">List</span>[<span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;根据JSONB资料搜索用户&quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># 构建动态查询条件</span></span><br><span class="line">        conditions = []</span><br><span class="line">        params = []</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> key, value <span class="keyword">in</span> criteria.items():</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">isinstance</span>(value, <span class="built_in">str</span>):</span><br><span class="line">                condition = sql.SQL(<span class="string">&quot;profile_data-&gt;&gt;%s ILIKE %s&quot;</span>)</span><br><span class="line">                params.extend([key, <span class="string">f&quot;%<span class="subst">&#123;value&#125;</span>%&quot;</span>])</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                condition = sql.SQL(<span class="string">&quot;profile_data-&gt;&gt;%s = %s&quot;</span>)</span><br><span class="line">                params.extend([key, <span class="built_in">str</span>(value)])</span><br><span class="line">            conditions.append(condition)</span><br><span class="line">        </span><br><span class="line">        where_clause = sql.SQL(<span class="string">&quot; AND &quot;</span>).join(conditions) <span class="keyword">if</span> conditions <span class="keyword">else</span> sql.SQL(<span class="string">&quot;true&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        query = sql.SQL(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        SELECT id, name, email, profile_data</span></span><br><span class="line"><span class="string">        FROM users</span></span><br><span class="line"><span class="string">        WHERE is_active = true AND &#123;&#125;</span></span><br><span class="line"><span class="string">        ORDER BY created_at DESC</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span>).<span class="built_in">format</span>(where_clause)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">with</span> self.get_connection() <span class="keyword">as</span> conn:</span><br><span class="line">                <span class="keyword">with</span> conn.cursor(row_factory=psycopg.rows.dict_row) <span class="keyword">as</span> cur:</span><br><span class="line">                    cur.execute(query, params)</span><br><span class="line">                    <span class="keyword">return</span> cur.fetchall()</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            logger.error(<span class="string">f&quot;Failed to search users by profile: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">raise</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">close</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;关闭连接池&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> self.pool:</span><br><span class="line">            self.pool.close()</span><br><span class="line">            logger.info(<span class="string">&quot;Database connection pool closed&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用示例</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># 配置</span></span><br><span class="line">    config = &#123;</span><br><span class="line">        <span class="string">&#x27;host&#x27;</span>: <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;port&#x27;</span>: <span class="number">5432</span>,</span><br><span class="line">        <span class="string">&#x27;dbname&#x27;</span>: <span class="string">&#x27;myapp&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;user&#x27;</span>: <span class="string">&#x27;app_user&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;secure_password&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;min_size&#x27;</span>: <span class="number">5</span>,</span><br><span class="line">        <span class="string">&#x27;max_size&#x27;</span>: <span class="number">20</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 初始化服务</span></span><br><span class="line">        db_service = PostgreSQLService(config)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 创建用户</span></span><br><span class="line">        user_id = db_service.create_user(<span class="string">&quot;孙七&quot;</span>, <span class="string">&quot;sunqi@example.com&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Created user with ID: <span class="subst">&#123;user_id&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 获取用户</span></span><br><span class="line">        user = db_service.get_user(user_id)</span><br><span class="line">        <span class="keyword">if</span> user:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;User found: <span class="subst">&#123;user&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 更新用户资料</span></span><br><span class="line">        profile = &#123;</span><br><span class="line">            <span class="string">&#x27;age&#x27;</span>: <span class="number">28</span>,</span><br><span class="line">            <span class="string">&#x27;city&#x27;</span>: <span class="string">&#x27;上海&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;hobbies&#x27;</span>: [<span class="string">&#x27;reading&#x27;</span>, <span class="string">&#x27;coding&#x27;</span>, <span class="string">&#x27;travel&#x27;</span>],</span><br><span class="line">            <span class="string">&#x27;settings&#x27;</span>: &#123;<span class="string">&#x27;theme&#x27;</span>: <span class="string">&#x27;dark&#x27;</span>, <span class="string">&#x27;notifications&#x27;</span>: <span class="literal">True</span>&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        db_service.update_user_profile(user_id, profile)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;User profile updated successfully&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 搜索用户</span></span><br><span class="line">        results = db_service.search_users_by_profile(&#123;<span class="string">&#x27;city&#x27;</span>: <span class="string">&#x27;上海&#x27;</span>&#125;)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Found <span class="subst">&#123;<span class="built_in">len</span>(results)&#125;</span> users in Shanghai&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 事务操作</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            db_service.transfer_money(<span class="number">1</span>, <span class="number">2</span>, <span class="number">200.00</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Money transfer successful&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Transfer failed: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        logger.error(<span class="string">f&quot;Application error: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;db_service&#x27;</span> <span class="keyword">in</span> <span class="built_in">locals</span>():</span><br><span class="line">            db_service.close()</span><br></pre></td></tr></table></figure><hr><h2 id="第六部分：运维与优化最佳实践"><a href="#第六部分：运维与优化最佳实践" class="headerlink" title="第六部分：运维与优化最佳实践"></a>第六部分：运维与优化最佳实践</h2><h3 id="6-1-性能调优关键点"><a href="#6-1-性能调优关键点" class="headerlink" title="6.1 性能调优关键点"></a>6.1 性能调优关键点</h3><h4 id="6-1-1-查询优化"><a href="#6-1-1-查询优化" class="headerlink" title="6.1.1 查询优化"></a>6.1.1 查询优化</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 使用EXPLAIN ANALYZE分析查询</span></span><br><span class="line">EXPLAIN ANALYZE <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> orders </span><br><span class="line"><span class="keyword">WHERE</span> customer_id <span class="operator">=</span> <span class="number">123</span> </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> order_date <span class="keyword">DESC</span> </span><br><span class="line">LIMIT <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建合适的索引</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX CONCURRENTLY idx_orders_customer_date <span class="keyword">ON</span> orders (customer_id, order_date <span class="keyword">DESC</span>);</span><br><span class="line"><span class="keyword">CREATE</span> INDEX CONCURRENTLY idx_orders_status <span class="keyword">ON</span> orders (status) <span class="keyword">WHERE</span> status <span class="keyword">IN</span> (<span class="string">&#x27;pending&#x27;</span>, <span class="string">&#x27;processing&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 避免SELECT *，只选择需要的字段</span></span><br><span class="line"><span class="keyword">SELECT</span> id, order_date, total_amount <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> customer_id <span class="operator">=</span> <span class="number">123</span>;</span><br></pre></td></tr></table></figure><h4 id="6-1-2-配置优化监控"><a href="#6-1-2-配置优化监控" class="headerlink" title="6.1.2 配置优化监控"></a>6.1.2 配置优化监控</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 监控配置更改效果</span></span><br><span class="line"><span class="keyword">SELECT</span> name, setting, unit, category, short_desc </span><br><span class="line"><span class="keyword">FROM</span> pg_settings </span><br><span class="line"><span class="keyword">WHERE</span> name <span class="keyword">IN</span> (</span><br><span class="line">    <span class="string">&#x27;shared_buffers&#x27;</span>, <span class="string">&#x27;work_mem&#x27;</span>, <span class="string">&#x27;effective_cache_size&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;maintenance_work_mem&#x27;</span>, <span class="string">&#x27;max_connections&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 监控活跃会话</span></span><br><span class="line"><span class="keyword">SELECT</span> pid, usename, application_name, client_addr, state, query, query_start</span><br><span class="line"><span class="keyword">FROM</span> pg_stat_activity </span><br><span class="line"><span class="keyword">WHERE</span> state <span class="operator">!=</span> <span class="string">&#x27;idle&#x27;</span> </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> query_start;</span><br></pre></td></tr></table></figure><h3 id="6-2-备份恢复策略"><a href="#6-2-备份恢复策略" class="headerlink" title="6.2 备份恢复策略"></a>6.2 备份恢复策略</h3><h4 id="6-2-1-物理备份（基础备份）"><a href="#6-2-1-物理备份（基础备份）" class="headerlink" title="6.2.1 物理备份（基础备份）"></a>6.2.1 物理备份（基础备份）</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 全量备份</span></span><br><span class="line">sudo -u postgres pg_basebackup -h localhost -U backup_user -D /backup/full_backup -Ft -z -P -X stream</span><br><span class="line"></span><br><span class="line"><span class="comment"># 增量备份（WAL归档）</span></span><br><span class="line"><span class="comment"># 配置postgresql.conf:</span></span><br><span class="line">wal_level = replica</span><br><span class="line">archive_mode = on</span><br><span class="line">archive_command = <span class="string">&#x27;test ! -f /backup/wal/%f &amp;&amp; cp %p /backup/wal/%f&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="6-2-2-逻辑备份（pg-dump）"><a href="#6-2-2-逻辑备份（pg-dump）" class="headerlink" title="6.2.2 逻辑备份（pg_dump）"></a>6.2.2 逻辑备份（pg_dump）</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 全库备份</span></span><br><span class="line">pg_dump -h localhost -U backup_user -Fc myapp &gt; /backup/myapp_$(<span class="built_in">date</span> +%Y%m%d).dump</span><br><span class="line"></span><br><span class="line"><span class="comment"># 单表备份</span></span><br><span class="line">pg_dump -h localhost -U backup_user -t <span class="built_in">users</span> myapp &gt; /backup/users_$(<span class="built_in">date</span> +%Y%m%d).sql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定时备份脚本</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">BACKUP_DIR=<span class="string">&quot;/backup/daily&quot;</span></span><br><span class="line">DATE=$(<span class="built_in">date</span> +%Y%m%d_%H%M%S)</span><br><span class="line">DB_NAME=<span class="string">&quot;myapp&quot;</span></span><br><span class="line">USER=<span class="string">&quot;backup_user&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$BACKUP_DIR</span></span><br><span class="line">pg_dump -h localhost -U <span class="variable">$USER</span> -Fc <span class="variable">$DB_NAME</span> &gt; <span class="variable">$BACKUP_DIR</span>/<span class="variable">$&#123;DB_NAME&#125;</span>_<span class="variable">$&#123;DATE&#125;</span>.dump</span><br><span class="line">find <span class="variable">$BACKUP_DIR</span> -name <span class="string">&quot;*.dump&quot;</span> -mtime +7 -delete</span><br></pre></td></tr></table></figure><h3 id="6-3-安全配置注意事项"><a href="#6-3-安全配置注意事项" class="headerlink" title="6.3 安全配置注意事项"></a>6.3 安全配置注意事项</h3><h4 id="6-3-1-关键安全配置"><a href="#6-3-1-关键安全配置" class="headerlink" title="6.3.1 关键安全配置"></a>6.3.1 关键安全配置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改pg_hba.conf，限制访问</span></span><br><span class="line"><span class="comment"># TYPE  DATABASE        USER            ADDRESS                 METHOD</span></span><br><span class="line">host    all             app_user        192.168.1.0/24          scram-sha-256</span><br><span class="line">host    replication     replicator      192.168.1.100/32        scram-sha-256</span><br><span class="line"><span class="built_in">local</span>   all             postgres                                peer</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重载配置</span></span><br><span class="line">sudo systemctl reload postgresql@16-main</span><br></pre></td></tr></table></figure><h4 id="6-3-2-安全审计脚本"><a href="#6-3-2-安全审计脚本" class="headerlink" title="6.3.2 安全审计脚本"></a>6.3.2 安全审计脚本</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建审计日志表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> audit_log (</span><br><span class="line">    id SERIAL <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">    event_time <span class="type">TIMESTAMP</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">    user_name <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    client_addr INET,</span><br><span class="line">    query_text TEXT,</span><br><span class="line">    action <span class="type">VARCHAR</span>(<span class="number">50</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建审计函数</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE <span class="keyword">FUNCTION</span> log_audit_event() <span class="keyword">RETURNS</span> <span class="keyword">TRIGGER</span> <span class="keyword">AS</span> $$</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">INSERT</span> <span class="keyword">INTO</span> audit_log (user_name, client_addr, query_text, action)</span><br><span class="line">    <span class="keyword">VALUES</span> (</span><br><span class="line">        <span class="built_in">current_user</span>,</span><br><span class="line">        inet_client_addr(),</span><br><span class="line">        current_query(),</span><br><span class="line">        TG_OP</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">RETURN</span> <span class="keyword">NEW</span>;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line">$$ <span class="keyword">LANGUAGE</span> plpgsql;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 为重要表创建审计触发器</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> audit_users_trigger</span><br><span class="line">AFTER <span class="keyword">INSERT</span> <span class="keyword">OR</span> <span class="keyword">UPDATE</span> <span class="keyword">OR</span> <span class="keyword">DELETE</span> <span class="keyword">ON</span> users</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span> <span class="keyword">EXECUTE</span> <span class="keyword">FUNCTION</span> log_audit_event();</span><br></pre></td></tr></table></figure><p><strong>核心安全原则</strong>：</p><ul><li>最小权限原则：每个应用用户只拥有必要的权限</li><li>网络隔离：数据库服务器不应直接暴露在公网</li><li>定期审计：检查用户权限、访问日志、敏感操作</li><li>加密传输：启用SSL连接，保护数据在传输过程中的安全</li><li>定期更新：及时应用安全补丁，关注CVE公告</li></ul><hr><h2 id="基于Debian-12的PostgreSQL源码编译一键部署脚本（注意校验源码和版本⚠️）"><a href="#基于Debian-12的PostgreSQL源码编译一键部署脚本（注意校验源码和版本⚠️）" class="headerlink" title="基于Debian 12的PostgreSQL源码编译一键部署脚本（注意校验源码和版本⚠️）"></a>基于Debian 12的PostgreSQL源码编译一键部署脚本（注意校验源码和版本⚠️）</h2><h6 id="基于Debian-12的PostgreSQL源码编译一键部署脚本，该脚本会自动安装依赖、编译源码、配置服务，并生成关键配置信息到config-md文件："><a href="#基于Debian-12的PostgreSQL源码编译一键部署脚本，该脚本会自动安装依赖、编译源码、配置服务，并生成关键配置信息到config-md文件：" class="headerlink" title="基于Debian 12的PostgreSQL源码编译一键部署脚本，该脚本会自动安装依赖、编译源码、配置服务，并生成关键配置信息到config.md文件："></a>基于Debian 12的PostgreSQL源码编译一键部署脚本，该脚本会自动安装依赖、编译源码、配置服务，并生成关键配置信息到config.md文件：</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># PostgreSQL 16 Source Compilation and Deployment Script for Debian 12</span></span><br><span class="line"><span class="comment"># Date: 2026-01-03</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> -e</span><br><span class="line"></span><br><span class="line"><span class="comment"># Configuration variables</span></span><br><span class="line">PG_VERSION=<span class="string">&quot;16.2&quot;</span></span><br><span class="line">PG_USER=<span class="string">&quot;postgres&quot;</span></span><br><span class="line">PG_GROUP=<span class="string">&quot;postgres&quot;</span></span><br><span class="line">PG_HOME=<span class="string">&quot;/usr/local/pgsql&quot;</span></span><br><span class="line">PG_DATA=<span class="string">&quot;/var/lib/postgresql/<span class="variable">$&#123;PG_VERSION&#125;</span>/data&quot;</span></span><br><span class="line">PG_LOG=<span class="string">&quot;/var/log/postgresql&quot;</span></span><br><span class="line">PG_PORT=<span class="string">&quot;5432&quot;</span></span><br><span class="line">SYSTEMD_SERVICE_FILE=<span class="string">&quot;/etc/systemd/system/postgresql.service&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== Starting PostgreSQL <span class="variable">$&#123;PG_VERSION&#125;</span> Source Compilation and Deployment ===&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;System information:&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;OS: <span class="subst">$(lsb_release -sd)</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Kernel: <span class="subst">$(uname -r)</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Architecture: <span class="subst">$(uname -m)</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Step 1: Install required dependencies</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== Step 1: Installing required dependencies ===&quot;</span></span><br><span class="line">sudo apt update</span><br><span class="line">sudo apt install -y \</span><br><span class="line">    build-essential \</span><br><span class="line">    liblz4-dev \</span><br><span class="line">    lz4 \</span><br><span class="line">    pkg-config \</span><br><span class="line">    libreadline-dev \</span><br><span class="line">    zlib1g-dev \</span><br><span class="line">    libxml2-dev \</span><br><span class="line">    libxml2 \</span><br><span class="line">    libssh-dev \</span><br><span class="line">    uuid-dev \</span><br><span class="line">    libssl-dev \</span><br><span class="line">    libpam0g-dev \</span><br><span class="line">    libicu-dev \</span><br><span class="line">    libsystemd-dev \</span><br><span class="line">    libkrb5-dev \</span><br><span class="line">    libselinux1-dev \</span><br><span class="line">    libxslt1-dev \</span><br><span class="line">    libperl-dev \</span><br><span class="line">    python3-dev \</span><br><span class="line">    tcl-dev \</span><br><span class="line">    flex \</span><br><span class="line">    bison \</span><br><span class="line">    systemd \</span><br><span class="line">    curl \</span><br><span class="line">    wget \</span><br><span class="line">    git \</span><br><span class="line">    ca-certificates </span><br><span class="line"></span><br><span class="line"><span class="comment"># Step 2: Create PostgreSQL user and directories</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== Step 2: Creating PostgreSQL user and directories ===&quot;</span></span><br><span class="line"><span class="keyword">if</span> ! <span class="built_in">id</span> -u <span class="string">&quot;<span class="variable">$PG_USER</span>&quot;</span> &gt;/dev/null 2&gt;&amp;1; <span class="keyword">then</span></span><br><span class="line">    sudo useradd -r -s /bin/bash -d <span class="string">&quot;<span class="variable">$PG_HOME</span>&quot;</span> -U <span class="string">&quot;<span class="variable">$PG_USER</span>&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Created user: <span class="variable">$PG_USER</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">sudo <span class="built_in">mkdir</span> -p <span class="string">&quot;<span class="variable">$PG_DATA</span>&quot;</span></span><br><span class="line">sudo <span class="built_in">mkdir</span> -p <span class="string">&quot;<span class="variable">$PG_LOG</span>&quot;</span></span><br><span class="line">sudo <span class="built_in">chown</span> -R <span class="string">&quot;<span class="variable">$PG_USER</span>:<span class="variable">$PG_GROUP</span>&quot;</span> <span class="string">&quot;<span class="variable">$PG_DATA</span>&quot;</span> <span class="string">&quot;<span class="variable">$PG_LOG</span>&quot;</span> <span class="string">&quot;<span class="variable">$PG_HOME</span>&quot;</span></span><br><span class="line">sudo <span class="built_in">chmod</span> 0700 <span class="string">&quot;<span class="variable">$PG_DATA</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Step 3: Download and extract PostgreSQL source code</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== Step 3: Downloading and extracting PostgreSQL source code ===&quot;</span></span><br><span class="line"> <span class="built_in">cd</span> /tmp</span><br><span class="line">SOURCE_FILE=<span class="string">&quot;postgresql-<span class="variable">$&#123;PG_VERSION&#125;</span>.tar.gz&quot;</span></span><br><span class="line"> <span class="keyword">if</span> [ ! -f <span class="string">&quot;<span class="variable">$SOURCE_FILE</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    wget <span class="string">&quot;https://ftp.postgresql.org/pub/source/v<span class="variable">$&#123;PG_VERSION&#125;</span>/postgresql-<span class="variable">$&#123;PG_VERSION&#125;</span>.tar.gz&quot;</span></span><br><span class="line"> <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">tar -xzf <span class="string">&quot;<span class="variable">$SOURCE_FILE</span>&quot;</span></span><br><span class="line"> <span class="built_in">cd</span> <span class="string">&quot;postgresql-<span class="variable">$&#123;PG_VERSION&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Step 4: Configure compilation options</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== Step 4: Configuring compilation options ===&quot;</span></span><br><span class="line">./configure \</span><br><span class="line">    --prefix=<span class="string">&quot;<span class="variable">$PG_HOME</span>&quot;</span> \</span><br><span class="line">    --with-pgport=<span class="string">&quot;<span class="variable">$PG_PORT</span>&quot;</span> \</span><br><span class="line">    --with-systemd \</span><br><span class="line">    --with-system-tzdata=/usr/share/zoneinfo \</span><br><span class="line">    --with-openssl \</span><br><span class="line">    --with-pam \</span><br><span class="line">    --with-ldap \</span><br><span class="line">    --with-uuid=ossp \</span><br><span class="line">    --with-libxml \</span><br><span class="line">    --with-libxslt \</span><br><span class="line">    --enable-thread-safety \</span><br><span class="line">    --enable-debug \</span><br><span class="line">    --enable-cassert \</span><br><span class="line">    --with-icu \</span><br><span class="line">    --with-perl \</span><br><span class="line">    --with-python \</span><br><span class="line">    --with-tcl</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Configuration completed successfully.&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Step 5: Compile and install</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== Step 5: Compiling and installing PostgreSQL ===&quot;</span></span><br><span class="line">make -j$(<span class="built_in">nproc</span>) world</span><br><span class="line">sudo make install-world</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Installation completed successfully.&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Step 6: Initialize database cluster</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== Step 6: Initializing database cluster ===&quot;</span></span><br><span class="line">sudo -u <span class="string">&quot;<span class="variable">$PG_USER</span>&quot;</span> <span class="string">&quot;<span class="variable">$PG_HOME</span>/bin/initdb&quot;</span> -D <span class="string">&quot;<span class="variable">$PG_DATA</span>&quot;</span> -E UTF8 --locale=en_US.UTF-8</span><br><span class="line"></span><br><span class="line"><span class="comment"># Step 7: Configure PostgreSQL settings</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== Step 7: Configuring PostgreSQL settings ===&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Backup original config files</span></span><br><span class="line">sudo -u <span class="string">&quot;<span class="variable">$PG_USER</span>&quot;</span> <span class="built_in">cp</span> <span class="string">&quot;<span class="variable">$PG_DATA</span>/postgresql.conf&quot;</span> <span class="string">&quot;<span class="variable">$PG_DATA</span>/postgresql.conf.bak&quot;</span></span><br><span class="line">sudo -u <span class="string">&quot;<span class="variable">$PG_USER</span>&quot;</span> <span class="built_in">cp</span> <span class="string">&quot;<span class="variable">$PG_DATA</span>/pg_hba.conf&quot;</span> <span class="string">&quot;<span class="variable">$PG_DATA</span>/pg_hba.conf.bak&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Configure postgresql.conf</span></span><br><span class="line">sudo -u <span class="string">&quot;<span class="variable">$PG_USER</span>&quot;</span> <span class="built_in">tee</span> <span class="string">&quot;<span class="variable">$PG_DATA</span>/postgresql.conf&quot;</span> &gt; /dev/null &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string"># PostgreSQL configuration file</span></span><br><span class="line"><span class="string"># Generated by installation script on $(date)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># Connection Settings</span></span><br><span class="line"><span class="string">listen_addresses = &#x27;*&#x27;</span></span><br><span class="line"><span class="string">port = $PG_PORT</span></span><br><span class="line"><span class="string">max_connections = 100</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># Memory Settings</span></span><br><span class="line"><span class="string">shared_buffers = 128MB</span></span><br><span class="line"><span class="string">effective_cache_size = 4096MB</span></span><br><span class="line"><span class="string">work_mem = 4MB</span></span><br><span class="line"><span class="string">maintenance_work_mem = 64MB</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># WAL Settings</span></span><br><span class="line"><span class="string">wal_level = replica</span></span><br><span class="line"><span class="string">synchronous_commit = on</span></span><br><span class="line"><span class="string">wal_log_hints = on</span></span><br><span class="line"><span class="string">max_wal_senders = 10</span></span><br><span class="line"><span class="string">wal_keep_size = 1GB</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># Query Planning</span></span><br><span class="line"><span class="string">random_page_cost = 1.1</span></span><br><span class="line"><span class="string">effective_io_concurrency = 200</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># Error Reporting and Logging</span></span><br><span class="line"><span class="string">log_destination = &#x27;stderr&#x27;</span></span><br><span class="line"><span class="string">logging_collector = on</span></span><br><span class="line"><span class="string">log_directory = &#x27;$PG_LOG&#x27;</span></span><br><span class="line"><span class="string">log_filename = &#x27;postgresql-%Y-%m-%d_%H%M%S.log&#x27;</span></span><br><span class="line"><span class="string">log_file_mode = 0640</span></span><br><span class="line"><span class="string">log_truncate_on_rotation = on</span></span><br><span class="line"><span class="string">log_rotation_age = 1d</span></span><br><span class="line"><span class="string">log_rotation_size = 100MB</span></span><br><span class="line"><span class="string">log_min_duration_statement = 1000</span></span><br><span class="line"><span class="string">log_checkpoints = on</span></span><br><span class="line"><span class="string">log_connections = on</span></span><br><span class="line"><span class="string">log_disconnections = on</span></span><br><span class="line"><span class="string">log_lock_waits = on</span></span><br><span class="line"><span class="string">log_temp_files = -1</span></span><br><span class="line"><span class="string">log_autovacuum_min_duration = 0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># Runtime Statistics</span></span><br><span class="line"><span class="string">track_activities = on</span></span><br><span class="line"><span class="string">track_counts = on</span></span><br><span class="line"><span class="string">track_io_timing = on</span></span><br><span class="line"><span class="string">track_functions = all</span></span><br><span class="line"><span class="string">stats_temp_directory = &#x27;/var/run/postgresql&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># Autovacuum</span></span><br><span class="line"><span class="string">autovacuum = on</span></span><br><span class="line"><span class="string">log_autovacuum_min_duration = 0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># Client Connection Defaults</span></span><br><span class="line"><span class="string">timezone = &#x27;UTC&#x27;</span></span><br><span class="line"><span class="string">datestyle = &#x27;iso, mdy&#x27;</span></span><br><span class="line"><span class="string">lc_messages = &#x27;en_US.UTF-8&#x27;</span></span><br><span class="line"><span class="string">lc_monetary = &#x27;en_US.UTF-8&#x27;</span></span><br><span class="line"><span class="string">lc_numeric = &#x27;en_US.UTF-8&#x27;</span></span><br><span class="line"><span class="string">lc_time = &#x27;en_US.UTF-8&#x27;</span></span><br><span class="line"><span class="string">default_text_search_config = &#x27;pg_catalog.english&#x27;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Configure pg_hba.conf</span></span><br><span class="line">sudo -u <span class="string">&quot;<span class="variable">$PG_USER</span>&quot;</span> <span class="built_in">tee</span> <span class="string">&quot;<span class="variable">$PG_DATA</span>/pg_hba.conf&quot;</span> &gt; /dev/null &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string"># PostgreSQL Client Authentication Configuration File</span></span><br><span class="line"><span class="string"># Generated by installation script on $(date)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># TYPE  DATABASE        USER            ADDRESS                 METHOD</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># &quot;local&quot; is for Unix domain socket connections only</span></span><br><span class="line"><span class="string">local   all             all                                     peer</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># IPv4 local connections:</span></span><br><span class="line"><span class="string">host    all             all             127.0.0.1/32            scram-sha-256</span></span><br><span class="line"><span class="string">host    all             all             192.168.0.0/16          scram-sha-256</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># IPv6 local connections:</span></span><br><span class="line"><span class="string">host    all             all             ::1/128                 scram-sha-256</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># Allow replication connections from localhost</span></span><br><span class="line"><span class="string">local   replication     all                                     peer</span></span><br><span class="line"><span class="string">host    replication     all             127.0.0.1/32            scram-sha-256</span></span><br><span class="line"><span class="string">host    replication     all             ::1/128                 scram-sha-256</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Step 8: Create systemd service file</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== Step 8: Creating systemd service file ===&quot;</span></span><br><span class="line">sudo <span class="built_in">tee</span> <span class="string">&quot;<span class="variable">$SYSTEMD_SERVICE_FILE</span>&quot;</span> &gt; /dev/null &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description=PostgreSQL database server</span></span><br><span class="line"><span class="string">Documentation=man:postgres(1)</span></span><br><span class="line"><span class="string">After=network-online.target</span></span><br><span class="line"><span class="string">Wants=network-online.target</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">Type=notify</span></span><br><span class="line"><span class="string">User=$PG_USER</span></span><br><span class="line"><span class="string">Group=$PG_GROUP</span></span><br><span class="line"><span class="string">RuntimeDirectory=postgresql</span></span><br><span class="line"><span class="string">RuntimeDirectoryMode=755</span></span><br><span class="line"><span class="string">Environment=PGDATA=$PG_DATA</span></span><br><span class="line"><span class="string">Environment=PGLOG=$PG_LOG</span></span><br><span class="line"><span class="string">ExecStart=$PG_HOME/bin/postgres -D $PG_DATA -c config_file=$PG_DATA/postgresql.conf</span></span><br><span class="line"><span class="string">ExecReload=/bin/kill -HUP \$MAINPID</span></span><br><span class="line"><span class="string">KillMode=mixed</span></span><br><span class="line"><span class="string">KillSignal=SIGINT</span></span><br><span class="line"><span class="string">TimeoutSec=120</span></span><br><span class="line"><span class="string">Restart=always</span></span><br><span class="line"><span class="string">RestartSec=30</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Step 9: Set proper permissions</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== Step 9: Setting proper permissions ===&quot;</span></span><br><span class="line">sudo <span class="built_in">chown</span> -R <span class="string">&quot;<span class="variable">$PG_USER</span>:<span class="variable">$PG_GROUP</span>&quot;</span> <span class="string">&quot;<span class="variable">$PG_HOME</span>&quot;</span></span><br><span class="line">sudo <span class="built_in">chown</span> -R <span class="string">&quot;<span class="variable">$PG_USER</span>:<span class="variable">$PG_GROUP</span>&quot;</span> <span class="string">&quot;<span class="variable">$PG_DATA</span>&quot;</span></span><br><span class="line">sudo <span class="built_in">chown</span> -R <span class="string">&quot;<span class="variable">$PG_USER</span>:<span class="variable">$PG_GROUP</span>&quot;</span> <span class="string">&quot;<span class="variable">$PG_LOG</span>&quot;</span></span><br><span class="line">sudo <span class="built_in">chmod</span> 0700 <span class="string">&quot;<span class="variable">$PG_DATA</span>&quot;</span></span><br><span class="line">sudo <span class="built_in">chmod</span> 0755 <span class="string">&quot;<span class="variable">$PG_LOG</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Step 10: Start PostgreSQL service</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== Step 10: Starting PostgreSQL service ===&quot;</span></span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> postgresql</span><br><span class="line">sudo systemctl start postgresql</span><br><span class="line"></span><br><span class="line"><span class="comment"># Wait for service to start</span></span><br><span class="line"><span class="built_in">sleep</span> 5</span><br><span class="line"></span><br><span class="line"><span class="comment"># Step 11: Verify installation</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== Step 11: Verifying installation ===&quot;</span></span><br><span class="line">sudo -u <span class="string">&quot;<span class="variable">$PG_USER</span>&quot;</span> <span class="string">&quot;<span class="variable">$PG_HOME</span>/bin/psql&quot;</span> -c <span class="string">&quot;SELECT version();&quot;</span> postgres</span><br><span class="line">sudo -u <span class="string">&quot;<span class="variable">$PG_USER</span>&quot;</span> <span class="string">&quot;<span class="variable">$PG_HOME</span>/bin/pg_isready&quot;</span> -p <span class="string">&quot;<span class="variable">$PG_PORT</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Step 12: Generate config.md file with key configuration information</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== Step 12: Generating config.md file ===&quot;</span></span><br><span class="line"><span class="built_in">cat</span> &gt; config.md &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string"># PostgreSQL $&#123;PG_VERSION&#125; Configuration Summary</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## System Information</span></span><br><span class="line"><span class="string">- **OS**: $(lsb_release -sd)</span></span><br><span class="line"><span class="string">- **Kernel**: $(uname -r)</span></span><br><span class="line"><span class="string">- **Architecture**: $(uname -m)</span></span><br><span class="line"><span class="string">- **Installation Date**: $(date)</span></span><br><span class="line"><span class="string">- **Installation Method**: Source Compilation</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## PostgreSQL Installation Details</span></span><br><span class="line"><span class="string">- **Version**: $&#123;PG_VERSION&#125;</span></span><br><span class="line"><span class="string">- **Installation Path**: $PG_HOME</span></span><br><span class="line"><span class="string">- **Data Directory**: $PG_DATA</span></span><br><span class="line"><span class="string">- **Log Directory**: $PG_LOG</span></span><br><span class="line"><span class="string">- **Port**: $PG_PORT</span></span><br><span class="line"><span class="string">- **Service User**: $PG_USER</span></span><br><span class="line"><span class="string">- **Service Group**: $PG_GROUP</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## Key Configuration Files</span></span><br><span class="line"><span class="string">- **postgresql.conf**: $PG_DATA/postgresql.conf</span></span><br><span class="line"><span class="string">- **pg_hba.conf**: $PG_DATA/pg_hba.conf</span></span><br><span class="line"><span class="string">- **systemd Service**: $SYSTEMD_SERVICE_FILE</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## Important Configuration Parameters</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### Connection Settings</span></span><br><span class="line"><span class="string">- **listen_addresses**: &#x27;*&#x27;</span></span><br><span class="line"><span class="string">- **port**: $PG_PORT</span></span><br><span class="line"><span class="string">- **max_connections**: 100</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### Memory Settings</span></span><br><span class="line"><span class="string">- **shared_buffers**: 128MB</span></span><br><span class="line"><span class="string">- **effective_cache_size**: 4096MB</span></span><br><span class="line"><span class="string">- **work_mem**: 4MB</span></span><br><span class="line"><span class="string">- **maintenance_work_mem**: 64MB</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### WAL Settings</span></span><br><span class="line"><span class="string">- **wal_level**: replica</span></span><br><span class="line"><span class="string">- **wal_keep_size**: 1GB</span></span><br><span class="line"><span class="string">- **max_wal_senders**: 10</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### Security Settings</span></span><br><span class="line"><span class="string">- **Authentication Method**: scram-sha-256 (for remote connections)</span></span><br><span class="line"><span class="string">- **Local Authentication**: peer</span></span><br><span class="line"><span class="string">- **SSL**: Enabled</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### Logging Settings</span></span><br><span class="line"><span class="string">- **Log Directory**: $PG_LOG</span></span><br><span class="line"><span class="string">- **Log Rotation**: Daily</span></span><br><span class="line"><span class="string">- **Log File Size**: 100MB</span></span><br><span class="line"><span class="string">- **Slow Query Log**: &gt;1000ms</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## Service Management Commands</span></span><br><span class="line"><span class="string">- **Start Service**: \`sudo systemctl start postgresql\`</span></span><br><span class="line"><span class="string">- **Stop Service**: \`sudo systemctl stop postgresql\`</span></span><br><span class="line"><span class="string">- **Restart Service**: \`sudo systemctl restart postgresql\`</span></span><br><span class="line"><span class="string">- **Check Status**: \`sudo systemctl status postgresql\`</span></span><br><span class="line"><span class="string">- **Enable on Boot**: \`sudo systemctl enable postgresql\`</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## Database Access</span></span><br><span class="line"><span class="string">- **Local Access**: \`sudo -u $PG_USER $PG_HOME/bin/psql\`</span></span><br><span class="line"><span class="string">- **Remote Access**: Configure pg_hba.conf and firewall rules</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## Important Directories</span></span><br><span class="line"><span class="string">- **Binaries**: $PG_HOME/bin/</span></span><br><span class="line"><span class="string">- **Data Files**: $PG_DATA/</span></span><br><span class="line"><span class="string">- **Logs**: $PG_LOG/</span></span><br><span class="line"><span class="string">- **Configuration**: $PG_DATA/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## Backup and Recovery</span></span><br><span class="line"><span class="string">- **Base Backup Command**: \`$PG_HOME/bin/pg_basebackup -D /backup/path -Ft -z -P -X stream\`</span></span><br><span class="line"><span class="string">- **WAL Archive Command**: Configure in postgresql.conf</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## Performance Tuning Notes</span></span><br><span class="line"><span class="string">1. **shared_buffers**: Should be 25% of total RAM for dedicated database servers</span></span><br><span class="line"><span class="string">2. **work_mem**: Increase for complex queries with sorts and joins</span></span><br><span class="line"><span class="string">3. **maintenance_work_mem**: Increase for faster index creation and vacuum operations</span></span><br><span class="line"><span class="string">4. **effective_cache_size**: Should be 50-75% of total system memory</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## Security Recommendations</span></span><br><span class="line"><span class="string">1. **Firewall**: Restrict access to PostgreSQL port (5432) to trusted networks</span></span><br><span class="line"><span class="string">2. **SSL**: Enable SSL connections for remote clients</span></span><br><span class="line"><span class="string">3. **Password Policy**: Enforce strong passwords for database users</span></span><br><span class="line"><span class="string">4. **Regular Updates**: Keep PostgreSQL updated with security patches</span></span><br><span class="line"><span class="string">5. **Audit Logging**: Enable detailed logging for security monitoring</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## Monitoring Commands</span></span><br><span class="line"><span class="string">- **Check Connections**: \`$PG_HOME/bin/psql -c &quot;SELECT * FROM pg_stat_activity;&quot;\`</span></span><br><span class="line"><span class="string">- **Check Locks**: \`$PG_HOME/bin/psql -c &quot;SELECT * FROM pg_locks;&quot;\`</span></span><br><span class="line"><span class="string">- **Check Replication**: \`$PG_HOME/bin/psql -c &quot;SELECT * FROM pg_stat_replication;&quot;\`</span></span><br><span class="line"><span class="string">- **Check Table Sizes**: \`$PG_HOME/bin/psql -c &quot;SELECT schemaname, tablename, pg_size_pretty(pg_total_relation_size(schemaname||&#x27;.&#x27;||tablename)) FROM pg_tables ORDER BY pg_total_relation_size DESC LIMIT 10;&quot;\`</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## Troubleshooting</span></span><br><span class="line"><span class="string">- **Service Logs**: \`journalctl -u postgresql -f\`</span></span><br><span class="line"><span class="string">- **PostgreSQL Logs**: \`tail -f $PG_LOG/postgresql-$(date +&#x27;%Y-%m-%d&#x27;)_*.log\`</span></span><br><span class="line"><span class="string">- **Check Service Status**: \`systemctl status postgresql\`</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## Notes</span></span><br><span class="line"><span class="string">- This configuration is optimized for a development/medium production environment</span></span><br><span class="line"><span class="string">- For production environments, adjust memory settings based on available system resources</span></span><br><span class="line"><span class="string">- Always test configuration changes in a staging environment before applying to production</span></span><br><span class="line"><span class="string">- Regular backups are essential - implement a backup strategy using pg_dump or pg_basebackup</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== Installation completed successfully! ===&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Key configuration information has been saved to config.md&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;To verify the installation, run:&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;  sudo -u <span class="variable">$PG_USER</span> <span class="variable">$PG_HOME</span>/bin/psql -c \&quot;SELECT version();\&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;To manage the service:&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;  sudo systemctl status postgresql&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Configuration files:&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;  postgresql.conf: <span class="variable">$PG_DATA</span>/postgresql.conf&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;  pg_hba.conf: <span class="variable">$PG_DATA</span>/pg_hba.conf&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;  systemd service: <span class="variable">$SYSTEMD_SERVICE_FILE</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Log files are stored in: <span class="variable">$PG_LOG</span>&quot;</span></span><br></pre></td></tr></table></figure><p>这个脚本提供了完整的PostgreSQL 16源码编译部署流程，包括：</p><ol><li><strong>依赖安装</strong>：安装所有必需的编译依赖包</li><li><strong>用户和目录创建</strong>：创建专用的postgres用户和必要的目录结构</li><li><strong>源码下载和编译</strong>：下载官方源码并进行配置、编译和安装</li><li><strong>数据库初始化</strong>：初始化数据库集群</li><li><strong>配置文件设置</strong>：配置postgresql.conf和pg_hba.conf文件</li><li><strong>systemd服务配置</strong>：创建systemd服务文件以便于服务管理</li><li><strong>服务启动和验证</strong>：启动PostgreSQL服务并验证安装</li><li><strong>配置信息生成</strong>：生成详细的config.md文件，包含所有关键配置信息</li></ol><p>脚本执行完成后，config.md文件将包含：</p><ul><li>系统和安装信息</li><li>关键配置文件路径</li><li>重要配置参数详解</li><li>服务管理命令</li><li>数据库访问方法</li><li>备份恢复策略</li><li>性能调优建议</li><li>安全配置推荐</li><li>监控和故障排除命令</li></ul><p>这个脚本适用于Debian 12系统，可以作为生产环境部署的基础，用户可以根据具体需求调整配置参数。</p><p>⚠️ 注意此脚本时效PG版本以官方更新为主，可适时调整。</p><hr><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>本文从PostgreSQL的版本历史出发，深入探讨了在Debian 12环境下的完整实践路径，从基础安装配置到高级集群部署，再到多语言应用开发，形成了一个完整的知识体系。PostgreSQL的强大之处不仅在于其丰富的功能特性，更在于其稳定性和可扩展性。</p><p><strong>关键实践建议</strong>：</p><ol><li><strong>循序渐进</strong>：从单体部署开始，逐步过渡到主从复制，最后考虑集群方案</li><li><strong>监控先行</strong>：在生产环境部署前，确保监控体系完善</li><li><strong>备份为王</strong>：无论架构多么复杂，可靠的备份策略是最后的安全保障</li><li><strong>安全第一</strong>：从设计阶段就考虑安全因素，而不是事后补救</li><li><strong>持续学习</strong>：PostgreSQL社区活跃，新版本不断带来性能改进和新特性</li></ol><p>🔔 随着云原生技术和AI技术的发展，PostgreSQL在容器化、Serverless等场景下的应用将更加广泛,且<strong>大有成为AI基础设施的趋势</strong>。掌握PostgreSQL的核心原理和最佳实践，不仅能提升应用性能和可靠性，更能为技术架构的演进提供坚实基础。</p></div><div class="article-licensing box"><div class="licensing-title"><p>PostgreSQL深度实践：从Debian 12入门到集群部署及多语言应用</p><p><a href="https://www.wdft.com/2d0307b0.html">https://www.wdft.com/2d0307b0.html</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>Jaco Liu</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2025-12-17</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2026-01-29</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/Tutorial/">Tutorial</a><a class="link-muted mr-2" rel="tag" href="/tags/RDBMS/">RDBMS</a><a class="link-muted mr-2" rel="tag" href="/tags/postgresql/">postgresql</a><a class="link-muted mr-2" rel="tag" href="/tags/postgresql-syntax/">postgresql-syntax</a></div><div class="sharethis-inline-share-buttons"></div><script src="https://platform-api.sharethis.com/js/sharethis.js#property=627845fc01dad800199bf3d4&amp;product=inline-share-buttons" defer></script></article></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/6e5682ad.html"><i class="level-item fas fa-chevron-left"></i><span class="level-item">基于Qwen3的MCP架构的入门：学生信息管理系统完整实现Demo为例实践指南</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/4adbc11a.html"><span class="level-item">Discussion and analysis of Text2SQL technology, the most difficult pain point in the commercial implementation of agents.（Agent 商业落地里最难的痛点 Text2SQL 技术探讨和解析）</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><script src="/js/mermaid.min.js"></script></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen order-3"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="level is-mobile" href="#PG简述"><span class="level-left"><span class="level-item">1</span><span class="level-item">PG简述</span></span></a></li><li><a class="level is-mobile" href="#第一部分：PostgreSQL版本历史与特性演进"><span class="level-left"><span class="level-item">2</span><span class="level-item">第一部分：PostgreSQL版本历史与特性演进</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#1-1-版本发展脉络"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">1.1 版本发展脉络</span></span></a></li><li><a class="level is-mobile" href="#1-2-关键特性对比"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">1.2 关键特性对比</span></span></a></li></ul></li><li><a class="level is-mobile" href="#第二部分：Debian-12环境下的PostgreSQL实战"><span class="level-left"><span class="level-item">3</span><span class="level-item">第二部分：Debian 12环境下的PostgreSQL实战</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#2-1-安装与基础配置"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">2.1 安装与基础配置</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#2-1-1-安装PostgreSQL-16"><span class="level-left"><span class="level-item">3.1.1</span><span class="level-item">2.1.1 安装PostgreSQL 16</span></span></a></li><li><a class="level is-mobile" href="#2-1-2-基础目录结构"><span class="level-left"><span class="level-item">3.1.2</span><span class="level-item">2.1.2 基础目录结构</span></span></a></li></ul></li><li><a class="level is-mobile" href="#2-2-核心原理与架构"><span class="level-left"><span class="level-item">3.2</span><span class="level-item">2.2 核心原理与架构</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#2-2-1-进程架构"><span class="level-left"><span class="level-item">3.2.1</span><span class="level-item">2.2.1 进程架构</span></span></a></li><li><a class="level is-mobile" href="#2-2-2-存储结构"><span class="level-left"><span class="level-item">3.2.2</span><span class="level-item">2.2.2 存储结构</span></span></a></li></ul></li><li><a class="level is-mobile" href="#2-3-基础语法与高级特性"><span class="level-left"><span class="level-item">3.3</span><span class="level-item">2.3 基础语法与高级特性</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#2-3-1-基础CRUD操作"><span class="level-left"><span class="level-item">3.3.1</span><span class="level-item">2.3.1 基础CRUD操作</span></span></a></li><li><a class="level is-mobile" href="#2-3-2-高级特性实战"><span class="level-left"><span class="level-item">3.3.2</span><span class="level-item">2.3.2 高级特性实战</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#第三部分：从单体到集群的演进"><span class="level-left"><span class="level-item">4</span><span class="level-item">第三部分：从单体到集群的演进</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#3-1-单体架构优化"><span class="level-left"><span class="level-item">4.1</span><span class="level-item">3.1 单体架构优化</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#3-1-1-配置文件优化"><span class="level-left"><span class="level-item">4.1.1</span><span class="level-item">3.1.1 配置文件优化</span></span></a></li><li><a class="level is-mobile" href="#3-1-2-性能监控"><span class="level-left"><span class="level-item">4.1.2</span><span class="level-item">3.1.2 性能监控</span></span></a></li></ul></li><li><a class="level is-mobile" href="#3-2-主从复制配置"><span class="level-left"><span class="level-item">4.2</span><span class="level-item">3.2 主从复制配置</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#3-2-1-主服务器配置"><span class="level-left"><span class="level-item">4.2.1</span><span class="level-item">3.2.1 主服务器配置</span></span></a></li><li><a class="level is-mobile" href="#3-2-2-从服务器配置"><span class="level-left"><span class="level-item">4.2.2</span><span class="level-item">3.2.2 从服务器配置</span></span></a></li></ul></li><li><a class="level is-mobile" href="#3-3-集群部署方案"><span class="level-left"><span class="level-item">4.3</span><span class="level-item">3.3 集群部署方案</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#3-3-1-使用Patroni实现高可用"><span class="level-left"><span class="level-item">4.3.1</span><span class="level-item">3.3.1 使用Patroni实现高可用</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#第四部分：Docker容器化部署"><span class="level-left"><span class="level-item">5</span><span class="level-item">第四部分：Docker容器化部署</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#4-1-单容器部署"><span class="level-left"><span class="level-item">5.1</span><span class="level-item">4.1 单容器部署</span></span></a></li><li><a class="level is-mobile" href="#4-2-Docker-Compose多容器编排"><span class="level-left"><span class="level-item">5.2</span><span class="level-item">4.2 Docker Compose多容器编排</span></span></a></li><li><a class="level is-mobile" href="#4-3-集群容器化方案"><span class="level-left"><span class="level-item">5.3</span><span class="level-item">4.3 集群容器化方案</span></span></a></li></ul></li><li><a class="level is-mobile" href="#第五部分：多语言应用开发实战"><span class="level-left"><span class="level-item">6</span><span class="level-item">第五部分：多语言应用开发实战</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#5-1-PHP操作PostgreSQL"><span class="level-left"><span class="level-item">6.1</span><span class="level-item">5.1 PHP操作PostgreSQL</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#5-1-1-环境配置"><span class="level-left"><span class="level-item">6.1.1</span><span class="level-item">5.1.1 环境配置</span></span></a></li><li><a class="level is-mobile" href="#5-1-2-完整示例"><span class="level-left"><span class="level-item">6.1.2</span><span class="level-item">5.1.2 完整示例</span></span></a></li></ul></li><li><a class="level is-mobile" href="#5-2-Golang操作PostgreSQL"><span class="level-left"><span class="level-item">6.2</span><span class="level-item">5.2 Golang操作PostgreSQL</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#5-2-1-依赖安装"><span class="level-left"><span class="level-item">6.2.1</span><span class="level-item">5.2.1 依赖安装</span></span></a></li><li><a class="level is-mobile" href="#5-2-2-完整示例"><span class="level-left"><span class="level-item">6.2.2</span><span class="level-item">5.2.2 完整示例</span></span></a></li></ul></li><li><a class="level is-mobile" href="#5-3-Python操作PostgreSQL"><span class="level-left"><span class="level-item">6.3</span><span class="level-item">5.3 Python操作PostgreSQL</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#5-3-1-依赖安装"><span class="level-left"><span class="level-item">6.3.1</span><span class="level-item">5.3.1 依赖安装</span></span></a></li><li><a class="level is-mobile" href="#5-3-2-完整示例"><span class="level-left"><span class="level-item">6.3.2</span><span class="level-item">5.3.2 完整示例</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#第六部分：运维与优化最佳实践"><span class="level-left"><span class="level-item">7</span><span class="level-item">第六部分：运维与优化最佳实践</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#6-1-性能调优关键点"><span class="level-left"><span class="level-item">7.1</span><span class="level-item">6.1 性能调优关键点</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#6-1-1-查询优化"><span class="level-left"><span class="level-item">7.1.1</span><span class="level-item">6.1.1 查询优化</span></span></a></li><li><a class="level is-mobile" href="#6-1-2-配置优化监控"><span class="level-left"><span class="level-item">7.1.2</span><span class="level-item">6.1.2 配置优化监控</span></span></a></li></ul></li><li><a class="level is-mobile" href="#6-2-备份恢复策略"><span class="level-left"><span class="level-item">7.2</span><span class="level-item">6.2 备份恢复策略</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#6-2-1-物理备份（基础备份）"><span class="level-left"><span class="level-item">7.2.1</span><span class="level-item">6.2.1 物理备份（基础备份）</span></span></a></li><li><a class="level is-mobile" href="#6-2-2-逻辑备份（pg-dump）"><span class="level-left"><span class="level-item">7.2.2</span><span class="level-item">6.2.2 逻辑备份（pg_dump）</span></span></a></li></ul></li><li><a class="level is-mobile" href="#6-3-安全配置注意事项"><span class="level-left"><span class="level-item">7.3</span><span class="level-item">6.3 安全配置注意事项</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#6-3-1-关键安全配置"><span class="level-left"><span class="level-item">7.3.1</span><span class="level-item">6.3.1 关键安全配置</span></span></a></li><li><a class="level is-mobile" href="#6-3-2-安全审计脚本"><span class="level-left"><span class="level-item">7.3.2</span><span class="level-item">6.3.2 安全审计脚本</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#基于Debian-12的PostgreSQL源码编译一键部署脚本（注意校验源码和版本⚠️）"><span class="level-left"><span class="level-item">8</span><span class="level-item">基于Debian 12的PostgreSQL源码编译一键部署脚本（注意校验源码和版本⚠️）</span></span></a></li><li><a class="level is-mobile" href="#总结"><span class="level-left"><span class="level-item">9</span><span class="level-item">总结</span></span></a></li></ul></div></div><style>#toc .menu-list>li>a.is-active+.menu-list{display:block}#toc .menu-list>li>a+.menu-list{display:none}</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><figure class="media-left"><a class="image" href="/a6cbebf9.html"><img src="/assets/images/golang/golang-01.png" alt="深入Go标准库time包深度解构与实践以及开发中注意的要点"></a></figure><div class="media-content"><p class="date"><time datetime="2026-01-28T14:17:44.000Z">2026-01-28</time></p><p class="title"><a href="/a6cbebf9.html">深入Go标准库time包深度解构与实践以及开发中注意的要点</a></p><p class="categories"><a href="/categories/golang/">golang</a> / <a href="/categories/golang/standard-library/">standard-library</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2ae30f65.html"><img src="/assets/images/ai-logo.png" alt="基于 Eino 框架构建智能客服 Agent：MCP 与 Skills 的工程化实践初探"></a></figure><div class="media-content"><p class="date"><time datetime="2026-01-27T17:25:24.000Z">2026-01-28</time></p><p class="title"><a href="/2ae30f65.html">基于 Eino 框架构建智能客服 Agent：MCP 与 Skills 的工程化实践初探</a></p><p class="categories"><a href="/categories/AI/">AI</a> / <a href="/categories/AI/Agent/">Agent</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/62bcfffd.html"><img src="/assets/images/linux01.jpg" alt="使用 CentOS + firewalld 脚本实现扫描类IP来访者的智能快速封禁(生产环境慎用⚠️)"></a></figure><div class="media-content"><p class="date"><time datetime="2026-01-27T15:12:03.000Z">2026-01-27</time></p><p class="title"><a href="/62bcfffd.html">使用 CentOS + firewalld 脚本实现扫描类IP来访者的智能快速封禁(生产环境慎用⚠️)</a></p><p class="categories"><a href="/categories/linux/">linux</a> / <a href="/categories/linux/security/">security</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/65fc9071.html"><img src="/assets/images/linux01.jpg" alt="使用 UFW + Shell 脚本实现扫描类IP来访者的智能快速封禁(生产环境慎用⚠️)"></a></figure><div class="media-content"><p class="date"><time datetime="2026-01-27T14:12:03.000Z">2026-01-27</time></p><p class="title"><a href="/65fc9071.html">使用 UFW + Shell 脚本实现扫描类IP来访者的智能快速封禁(生产环境慎用⚠️)</a></p><p class="categories"><a href="/categories/linux/">linux</a> / <a href="/categories/linux/security/">security</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/276d47b6.html"><img src="/assets/images/ai-logo.png" alt="基于 HEART 架构理念的隐私保护AI健康应用设计的一种架构思路实践解决方案"></a></figure><div class="media-content"><p class="date"><time datetime="2026-01-25T15:24:37.000Z">2026-01-25</time></p><p class="title"><a href="/276d47b6.html">基于 HEART 架构理念的隐私保护AI健康应用设计的一种架构思路实践解决方案</a></p><p class="categories"><a href="/categories/AI/">AI</a> / <a href="/categories/AI/Agent/">Agent</a></p></div></article></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/AI/"><span class="level-start"><span class="level-item">AI</span></span><span class="level-end"><span class="level-item tag">14</span></span></a><ul><li><a class="level is-mobile" href="/categories/AI/AIGC/"><span class="level-start"><span class="level-item">AIGC</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/AI/Agent/"><span class="level-start"><span class="level-item">Agent</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/categories/AI/Algo/"><span class="level-start"><span class="level-item">Algo</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/GIT/"><span class="level-start"><span class="level-item">GIT</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/architecture/"><span class="level-start"><span class="level-item">architecture</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/clang/"><span class="level-start"><span class="level-item">clang</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/cloud/"><span class="level-start"><span class="level-item">cloud</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/daily/"><span class="level-start"><span class="level-item">daily</span></span><span class="level-end"><span class="level-item tag">5</span></span></a><ul><li><a class="level is-mobile" href="/categories/daily/business/"><span class="level-start"><span class="level-item">business</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/daily/note/"><span class="level-start"><span class="level-item">note</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/golang/"><span class="level-start"><span class="level-item">golang</span></span><span class="level-end"><span class="level-item tag">29</span></span></a><ul><li><a class="level is-mobile" href="/categories/golang/standard-library/"><span class="level-start"><span class="level-item">standard-library</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/golang/tutorial/"><span class="level-start"><span class="level-item">tutorial</span></span><span class="level-end"><span class="level-item tag">27</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/java/"><span class="level-start"><span class="level-item">java</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/javascript/"><span class="level-start"><span class="level-item">javascript</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/linux/"><span class="level-start"><span class="level-item">linux</span></span><span class="level-end"><span class="level-item tag">8</span></span></a><ul><li><a class="level is-mobile" href="/categories/linux/centos/"><span class="level-start"><span class="level-item">centos</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/linux/debian/"><span class="level-start"><span class="level-item">debian</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/linux/security/"><span class="level-start"><span class="level-item">security</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/linux/tools/"><span class="level-start"><span class="level-item">tools</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/lua/"><span class="level-start"><span class="level-item">lua</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/macOS/"><span class="level-start"><span class="level-item">macOS</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/message/"><span class="level-start"><span class="level-item">message</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/nosql/"><span class="level-start"><span class="level-item">nosql</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/olap/"><span class="level-start"><span class="level-item">olap</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/php/"><span class="level-start"><span class="level-item">php</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/python/"><span class="level-start"><span class="level-item">python</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/rdbms/"><span class="level-start"><span class="level-item">rdbms</span></span><span class="level-end"><span class="level-item tag">6</span></span></a><ul><li><a class="level is-mobile" href="/categories/rdbms/mysql/"><span class="level-start"><span class="level-item">mysql</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/rdbms/postgres/"><span class="level-start"><span class="level-item">postgres</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/rdbms/sql/"><span class="level-start"><span class="level-item">sql</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/reprinted-articles/"><span class="level-start"><span class="level-item">reprinted-articles</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/AI/"><span class="tag">AI</span><span class="tag">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AIGC/"><span class="tag">AIGC</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Agent/"><span class="tag">Agent</span><span class="tag">10</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Agent-Skill/"><span class="tag">Agent-Skill</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Agent-Suggestion/"><span class="tag">Agent-Suggestion</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Agent-architecture/"><span class="tag">Agent-architecture</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Agent-framework/"><span class="tag">Agent-framework</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Algorithm/"><span class="tag">Algorithm</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CDN/"><span class="tag">CDN</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CentOS/"><span class="tag">CentOS</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Cloud-Distributed/"><span class="tag">Cloud-Distributed</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Cloud-Native/"><span class="tag">Cloud-Native</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Cloud-Native-Framework/"><span class="tag">Cloud-Native-Framework</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Controlnet/"><span class="tag">Controlnet</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/DDD/"><span class="tag">DDD</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Debian/"><span class="tag">Debian</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/DeepSeek/"><span class="tag">DeepSeek</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Deepseek/"><span class="tag">Deepseek</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Demo-AI/"><span class="tag">Demo-AI</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Distributed-Systems/"><span class="tag">Distributed-Systems</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Drawing/"><span class="tag">Drawing</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ES/"><span class="tag">ES</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Eino/"><span class="tag">Eino</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Elastic/"><span class="tag">Elastic</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ElasticSearch/"><span class="tag">ElasticSearch</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Firewalld/"><span class="tag">Firewalld</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Framework/"><span class="tag">Framework</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/GGUF/"><span class="tag">GGUF</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/GIT/"><span class="tag">GIT</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/GO-%E6%96%B9%E6%B3%95%E5%80%BC/"><span class="tag">GO 方法值</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/GPG/"><span class="tag">GPG</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/GPG2/"><span class="tag">GPG2</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/GRPO/"><span class="tag">GRPO</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/GUI/"><span class="tag">GUI</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Ghostty/"><span class="tag">Ghostty</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Go/"><span class="tag">Go</span><span class="tag">29</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Go-Summary-notes/"><span class="tag">Go Summary notes</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Go-null-judge/"><span class="tag">Go null judge</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Go-Struct-Method-Receiver/"><span class="tag">Go(Struct|Method|Receiver)</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Go-map/"><span class="tag">Go(map)</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Go-new-make-struct/"><span class="tag">Go(new,make,struct{})</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Go-string/"><span class="tag">Go(string)</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Go-Polymorphism/"><span class="tag">Go-Polymorphism</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Go-Printf/"><span class="tag">Go-Printf</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Go-chain-operation/"><span class="tag">Go-chain-operation</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Go-context/"><span class="tag">Go-context</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Go-init/"><span class="tag">Go-init()</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Go-standard-library/"><span class="tag">Go-standard-library</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Go-time/"><span class="tag">Go-time</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Golang/"><span class="tag">Golang</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Google/"><span class="tag">Google</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/HEART/"><span class="tag">HEART</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/History/"><span class="tag">History</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Infra/"><span class="tag">Infra</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JS/"><span class="tag">JS</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JSON/"><span class="tag">JSON</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Java/"><span class="tag">Java</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Java17/"><span class="tag">Java17</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Java8/"><span class="tag">Java8</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JavaScript/"><span class="tag">JavaScript</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/K3S-Build/"><span class="tag">K3S-Build</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/K8S/"><span class="tag">K8S</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/K8S-Build/"><span class="tag">K8S-Build</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Kafka/"><span class="tag">Kafka</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/LLM/"><span class="tag">LLM</span><span class="tag">13</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux/"><span class="tag">Linux</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/LoRA/"><span class="tag">LoRA</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MCP/"><span class="tag">MCP</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Message/"><span class="tag">Message</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Microservices/"><span class="tag">Microservices</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MongoDB/"><span class="tag">MongoDB</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Movie/"><span class="tag">Movie</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Note-The-Legend-of-1900/"><span class="tag">Note The Legend of 1900</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/OLAP/"><span class="tag">OLAP</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/OpenSSH/"><span class="tag">OpenSSH</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Python/"><span class="tag">Python</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Qwen/"><span class="tag">Qwen</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RDBMS/"><span class="tag">RDBMS</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RabbitMQ/"><span class="tag">RabbitMQ</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Redis/"><span class="tag">Redis</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Rocky-linux/"><span class="tag">Rocky-linux</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SD/"><span class="tag">SD</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Skill/"><span class="tag">Skill</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/StarRocks/"><span class="tag">StarRocks</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Syntax/"><span class="tag">Syntax</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/TS/"><span class="tag">TS</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Text2SQL/"><span class="tag">Text2SQL</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Tutorial/"><span class="tag">Tutorial</span><span class="tag">12</span></a></div><div class="control"><a class="tags has-addons" href="/tags/TypeScript/"><span class="tag">TypeScript</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/UFW/"><span class="tag">UFW</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Ubuntu/"><span class="tag">Ubuntu</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/VIM/"><span class="tag">VIM</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/VIM-Author/"><span class="tag">VIM Author</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/XHProf/"><span class="tag">XHProf</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ansi-lib/"><span class="tag">ansi-lib</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/banner/"><span class="tag">banner</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/business/"><span class="tag">business</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/centos7/"><span class="tag">centos7</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/changelog/"><span class="tag">changelog</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/chattr/"><span class="tag">chattr</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/clang/"><span class="tag">clang</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cli/"><span class="tag">cli</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/daily/"><span class="tag">daily</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/database/"><span class="tag">database</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/debian/"><span class="tag">debian</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/firewalld/"><span class="tag">firewalld</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/format/"><span class="tag">format</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/func/"><span class="tag">func</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/go-pprof/"><span class="tag">go-pprof</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/goroutine/"><span class="tag">goroutine</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/hexo/"><span class="tag">hexo</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/history/"><span class="tag">history</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/history-of-programing/"><span class="tag">history-of-programing</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/homebrew/"><span class="tag">homebrew</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/innodb/"><span class="tag">innodb</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/interface/"><span class="tag">interface</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/io/"><span class="tag">io</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/kebernetes/"><span class="tag">kebernetes</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/laravel/"><span class="tag">laravel</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/laravel-artisan/"><span class="tag">laravel-artisan</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/linux/"><span class="tag">linux</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/lua/"><span class="tag">lua</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/macOS/"><span class="tag">macOS</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/macro/"><span class="tag">macro</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/motd/"><span class="tag">motd</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mysql/"><span class="tag">mysql</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mysql8-0/"><span class="tag">mysql8.0</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mysql8-x/"><span class="tag">mysql8.x</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nanochat/"><span class="tag">nanochat</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nanochat-zh-CN/"><span class="tag">nanochat-zh_CN</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/neofetch/"><span class="tag">neofetch</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nginx/"><span class="tag">nginx</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nosql/"><span class="tag">nosql</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/oh-my-zsh/"><span class="tag">oh-my-zsh</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/omz/"><span class="tag">omz</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/openssl/"><span class="tag">openssl</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/package-time/"><span class="tag">package time</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/painting/"><span class="tag">painting</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/php/"><span class="tag">php</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/pointer/"><span class="tag">pointer</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/postgresql/"><span class="tag">postgresql</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/postgresql-syntax/"><span class="tag">postgresql-syntax</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/postgressql-engine/"><span class="tag">postgressql-engine</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/python/"><span class="tag">python</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/reflect-%E5%8F%8D%E5%B0%84/"><span class="tag">reflect 反射</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rocky/"><span class="tag">rocky</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rocky-linux/"><span class="tag">rocky-linux</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rocky-linux-tools/"><span class="tag">rocky-linux-tools</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rsync/"><span class="tag">rsync</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rune/"><span class="tag">rune</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/security/"><span class="tag">security</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/services/"><span class="tag">services</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/slice-%E5%88%87%E7%89%87%E6%9C%AC%E8%B4%A8/"><span class="tag">slice 切片本质</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/sql/"><span class="tag">sql</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/stable-diffusion-webui/"><span class="tag">stable-diffusion-webui</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/struct/"><span class="tag">struct</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/switch/"><span class="tag">switch</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/systemd-service/"><span class="tag">systemd-service</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/terminal/"><span class="tag">terminal</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/travel/"><span class="tag">travel</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/type/"><span class="tag">type</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/type-%E5%85%B3%E9%94%AE%E8%AF%8D%E6%80%BB%E7%BB%93/"><span class="tag">type 关键词总结</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/utf8mb4/"><span class="tag">utf8mb4</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/utf8mb4-0900-ai-ci/"><span class="tag">utf8mb4_0900_ai_ci</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/utf8mb4-general-ci/"><span class="tag">utf8mb4_general_ci</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/zsh/"><span class="tag">zsh</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E4%BA%BA%E7%94%9F/"><span class="tag">人生</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/"><span class="tag">安全加固</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%97%A5%E5%B8%B8/"><span class="tag">日常</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%94%9F%E6%B4%BB/"><span class="tag">生活</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%BD%AC%E8%BD%BD/"><span class="tag">转载</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BD%93%E7%B3%BB/"><span class="tag">配置文件体系</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%98%B2%E7%81%AB%E5%A2%99/"><span class="tag">防火墙</span><span class="tag">3</span></a></div></div></div></div></div><div class="card widget" data-type="clustrmaps"><div class="card-content"><div class="menu"><h3 class="menu-label">CLUSTRMAPS</h3></div><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div style="margin-top:10px"><script type="text/javascript" id="clustrmaps" src="https://cdn.clustrmaps.com/map_v2.js?cl=ffffff&amp;w=250&amp;t=n&amp;d=xb7wV_PHYtl9KaSZpQgP9CLUNrXlqm480vcarJmX2A0&amp;co=2d78ad&amp;cmo=3acc3a&amp;cmn=ff5353&amp;ct=ffffff"></script><script type="text/javascript" id="clstr_globe" src="https://clustrmaps.com/globe.js?d=xb7wV_PHYtl9KaSZpQgP9CLUNrXlqm480vcarJmX2A0"></script></div></div></nav></div></div><div class="card widget" data-type="adsense"><div class="card-content"><div class="menu"><h3 class="menu-label">Advertisement</h3><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-8952360410310192" data-ad-slot="1345698037" data-ad-format="auto" data-full-width-responsive="true"></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div></div></div></div></div></div></section><footer class="footer" style="padding:1rem 1.5rem 0"><div class="container"><div class="level"><div class="level-start"><p class="is-size-7"><a class="footer-logo" style="margin-right:10px" href="/"><img src="/img/logo.svg" alt="Jaco Liu Personal Site (ljq@GitHub).安全贯穿于软件开发各个环节." height="16" style="max-height:1.25rem"></a><a href="http://beian.miit.gov.cn" target="_blank">鲁ICP备2023051700号</a>  <span>&copy; 2026 Jaco Liu</span>  <span style="color:#e0e0e0">Powered by <a style="color:#e0e0e0" href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a style="color:#e0e0e0" href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></span><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>  <span id="busuanzi_container_site_pv">Total Visits Counts: <span id="busuanzi_value_site_pv"></span>.</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Jaco Liu&#039;GitHub" href="https://github.com/ljq"><i class="fab fa-github"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="ref.wdft.com" href="https://ref.wdft.com"><i class="fas fa-cloud"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="cook.wdft.com" href="https://cook.wdft.com"><i class="fas fa-coffee"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Python PEP8" href="https://pep8.org"><i class="fas fa-coffee"></i></a></p> <span><i class="fas fa-link">BlogRoll:</i></span><p class="control" style="color:#26c1fa"><a class="button is-transparent" target="_blank" rel="noopener" title="Quick Reference" href="https://ref.wdft.com">Quick Reference</a></p><p class="control" style="color:#26c1fa"><a class="button is-transparent" target="_blank" rel="noopener" title="Cook" href="https://cook.wdft.com">Cook</a></p><p class="control" style="color:#26c1fa"><a class="button is-transparent" target="_blank" rel="noopener" title="koala-oss.app" href="https://koala-oss.app/news/">koala-oss.app</a></p><p class="control" style="color:#26c1fa"><a class="button is-transparent" target="_blank" rel="noopener" title="CS自学指南" href="https://csdiy.wiki">CS自学指南</a></p><p class="control" style="color:#26c1fa"><a class="button is-transparent" target="_blank" rel="noopener" title="Python PEP8" href="https://pep8.org">Python PEP8</a></p></div></div></div></div></footer><script src="https://cdnjs.loli.net/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" defer></script><script>moment.locale("en")</script><script>var IcarusThemeSettings={article:{highlight:{clipboard:!0,fold:"unfolded"}}}</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><script src="/js/switchDarkMode.js" defer></script><script src="/js/toutiaoSEO.js" defer></script><script src="https://cdnjs.loli.net/ajax/libs/cookieconsent/3.1.1/cookieconsent.min.js" defer></script><script>window.addEventListener("load",()=>{window.cookieconsent.initialise({type:"info",theme:"edgeless",static:!1,position:"bottom-left",content:{message:"This website uses cookies to improve your experience.",dismiss:"Got it!",allow:"Allow cookies",deny:"Decline",link:"Learn more",policy:"Cookie Policy",href:"https://www.cookiesandyou.com/"},palette:{popup:{background:"#edeff5",text:"#838391"},button:{background:"#4b81e8"}}})})</script><script src="https://cdnjs.loli.net/ajax/libs/lightgallery/1.10.0/js/lightgallery.min.js" defer></script><script src="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load",()=>{"function"==typeof $.fn.lightGallery&&$(".article").lightGallery({selector:".gallery-item"}),"function"==typeof $.fn.justifiedGallery&&($(".justified-gallery > p > .gallery-item").length&&$(".justified-gallery > p > .gallery-item").unwrap(),$(".justified-gallery").justifiedGallery())})</script><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener("DOMContentLoaded",function(){loadInsight({contentUrl:"/content.json"},{hint:"Type something...",untitled:"(Untitled)",posts:"Posts",pages:"Pages",categories:"Categories",tags:"Tags"})})</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginModelPath:"assets/",tagMode:!1,log:!1,model:{jsonPath:"/live2dw/assets/hijiki.model.json"},display:{position:"right",width:150,height:300},mobile:{show:!0},react:{opacity:.7},pluginJsPath:"lib/",pluginRootPath:"live2dw/"})</script></body></html>